import{c as Mt,u as Rt}from"./C_H-m1dF.js";import{i as Pt}from"./CsfJzf5f.js";import{u as St}from"./BdYR1MGi.js";import{P as _t,u as Tt}from"./Dw0BM4Dm.js";import{I as Ft}from"./BmkTCIb-.js";import{d as G,l as S,m as fe,A as Be,o as k,a as P,b as M,q as Ee,B as zt,t as J,g as $,s as j,F as N,_ as U,f as O,u as C,y as Ht,c as Q,r as ee,e as ze,h as q,w as te,R as Re,C as Ye,D as re,E as le,G as Lt,j as It,k as At,n as Dt,p as $t,i as Ot}from"./BFT9qVMJ.js";import{S as Ze,u as Wt}from"./CBY0Nbvu.js";import{q as Xt,W as me}from"./CJ1Q_tph.js";import{f as Gt,a as Ut}from"./UQLe1jqg.js";var K=(n=>(n.CPU="cpu",n.WALL_TIME="wt",n.MEMORY_CHANGE="pmu",n.MEMORY="mu",n.CALLS="ct",n))(K||{}),je=(n=>(n.CPU="cpu",n.WALL_TIME="wt",n.MEMORY_CHANGE="pmu",n.MEMORY="mu",n.CALLS="ct",n.EXCLUSIVE_CPU="excl_cpu",n.EXCLUSIVE_WALL_TIME="excl_wt",n.EXCLUSIVE_MEMORY_CHANGE="excl_pmu",n.EXCLUSIVE_MEMORY="excl_mu",n.EXCLUSIVE_CALLS="excl_ct",n))(je||{});const Vt=()=>({initialize:Pt}),Nt={key:0},Kt={class:"render-graph__tooltip-title"},qt=G({__name:"render-graph",props:{elements:{},height:{}},setup(n){const e=n,t=S(),i=S(),s=S(),r=S(),o=S(),a=S(),l=(c,d)=>{if(!c||!d){t.value=void 0,i.value=void 0;return}t.value=c.data();const u=d.offsetX,p=d.offsetY,{clientHeight:g=0,clientWidth:x=0}=a.value,{offsetHeight:v=0,offsetWidth:m=0}=o.value;let y=p,E=u;if(x+u>m-80){const T=x+u-m+100;E-=T}g+p>v&&(y=p-g),i.value={top:`${y+20}px`,left:`${E}px`}},{initialize:h}=Vt();return fe(()=>{s.value=h({container:r.value,elements:e.elements,onNodeHover:l})}),Be(()=>{s.value()}),(c,d)=>(k(),P(N,null,[M("div",{ref_key:"parent",ref:o,class:"render-graph",style:Ee({height:`${c.height}px`})},[M("div",{ref_key:"renderer",ref:r,class:"render-graph__in"},null,512)],4),M("div",{ref_key:"tooltip",ref:a,class:j(["render-graph__tooltip",{"render-graph__tooltip--active":t.value}]),style:Ee(i.value)},[t.value?(k(),P("div",Nt,[zt(c.$slots,"default",{data:t.value},()=>[M("h4",Kt,J(t.value),1)],!0)])):$("",!0)],6)],64))}}),Bt=U(qt,[["__scopeId","data-v-eeb98706"]]),Yt={class:"call-stat-board"},Zt={class:"call-stat-board__title"},jt=G({__name:"call-stat-board",props:{edge:{}},setup(n){return(e,t)=>(k(),P("div",Yt,[M("h4",Zt,J(e.edge.callee),1),O(C(Ze),{class:"call-stat-board__body",cost:e.edge.cost,size:"sm"},null,8,["cost"])]))}}),Qe=U(jt,[["__scopeId","data-v-4ee7682b"]]),Qt={class:"call-graph__toolbar-wrapper"},Jt={class:"call-graph__toolbar"},ei=["title","onClick"],ti={class:"call-graph__toolbar call-graph__toolbar--right"},ii={key:0,class:"call-graph__toolbar-input-wr"},ni=["value"],si={class:"call-graph__toolbar-input-wr"},ri=["value","min","max","step"],oi=G({__name:"call-graph-toolbar",props:{data:{},isFullscreen:{type:Boolean},metric:{},threshold:{},percent:{}},emits:["onMetricChange","onFullscreen","onThresholdChange","onPercentChange"],async setup(n,{emit:e}){let t,i;const s=e,r=n,o=async function(){return await r.data.then(h=>h.toolbar)},a=([t,i]=Ht(()=>o()),t=await t,i(),t),l=Q(()=>r.metric===K.CALLS?"Min calls":"Percent");return(h,c)=>(k(),P("div",Qt,[M("div",Jt,[M("button",{title:"Full screen",onClick:c[0]||(c[0]=d=>s("onFullscreen"))},[O(C(Ft),{name:"fullscreen",class:"call-graph__toolbar-icon"})]),(k(!0),P(N,null,ee(C(a),d=>(k(),P("button",{class:j(["call-graph__toolbar-action",{"call-graph__toolbar-action--active":h.metric===d.metric}]),title:d.description,onClick:u=>s("onMetricChange",d.metric)},J(d.label),11,ei))),256))]),M("div",ti,[h.metric!==C(K).CALLS?(k(),P("label",ii,[ze(" Threshold "),M("input",{class:"call-graph__toolbar-input",type:"number",value:h.threshold,min:0,max:10,step:.1,onInput:c[1]||(c[1]=d=>s("onThresholdChange",d.target.value))},null,40,ni)])):$("",!0),M("label",si,[ze(J(l.value)+" ",1),M("input",{class:"call-graph__toolbar-input",type:"number",value:h.percent,min:h.metric===C(K).CALLS?1:0,max:h.metric===C(K).CALLS?1e3:100,step:h.metric===C(K).CALLS?10:5,onInput:c[2]||(c[2]=d=>s("onPercentChange",d.target.value))},null,40,ri)])])]))}}),ai=U(oi,[["__scopeId","data-v-b863efa2"]]),li=G({__name:"call-graph",props:{payload:{}},setup(n){const e=n,t=S(!1),i=S(K.WALL_TIME),s=S(1),r=S(10),o=S(!1),a=S(),l=Q(async()=>await fetch(`${Re}/api/profiler/${e.payload.profile_uuid}/call-graph?threshold=${s.value}&percentage=${r.value}&metric=${i.value}`).then(g=>g.json())),h=Q(()=>`${i.value}-${s.value}-${r.value}`),c=g=>{i.value=g},d=g=>{s.value=g},u=g=>{r.value=g},p=Q(()=>t.value?window.innerHeight:a.value.offsetHeight);return fe(()=>{o.value=!0}),(g,x)=>(k(),P("div",{ref_key:"container",ref:a,class:j(["call-graph",{"call-graph--fullscreen":t.value}])},[o.value&&h.value?(k(),q(C(Bt),{key:h.value,class:"call-graph__graph",elements:l.value,height:p.value},{default:te(({data:{name:v,cost:m}})=>[O(C(Qe),{edge:{callee:v,caller:"",cost:m}},null,8,["edge"])]),_:1},8,["elements","height"])):$("",!0),O(C(ai),{data:l.value,metric:i.value,threshold:s.value,percent:r.value,isFullscreen:t.value,onOnMetricChange:c,onOnThresholdChange:d,onOnPercentChange:u,onOnFullscreen:x[0]||(x[0]=v=>t.value=!t.value)},null,8,["data","metric","threshold","percent","isFullscreen"])],2))}}),hi=U(li,[["__scopeId","data-v-9702b201"]]);var Je={exports:{}},ci={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},et={exports:{}},di=function(e){return!e||typeof e=="string"?!1:e instanceof Array||Array.isArray(e)||e.length>=0&&(e.splice instanceof Function||Object.getOwnPropertyDescriptor(e,e.length-1)&&e.constructor.name!=="String")},ui=di,gi=Array.prototype.concat,fi=Array.prototype.slice,He=et.exports=function(e){for(var t=[],i=0,s=e.length;i<s;i++){var r=e[i];ui(r)?t=gi.call(t,fi.call(r)):t.push(r)}return t};He.wrap=function(n){return function(){return n(He(arguments))}};var pi=et.exports,ne=ci,oe=pi,tt=Object.hasOwnProperty,it=Object.create(null);for(var ve in ne)tt.call(ne,ve)&&(it[ne[ve]]=ve);var I=Je.exports={to:{},get:{}};I.get=function(n){var e=n.substring(0,3).toLowerCase(),t,i;switch(e){case"hsl":t=I.get.hsl(n),i="hsl";break;case"hwb":t=I.get.hwb(n),i="hwb";break;default:t=I.get.rgb(n),i="rgb";break}return t?{model:i,value:t}:null};I.get.rgb=function(n){if(!n)return null;var e=/^#([a-f0-9]{3,4})$/i,t=/^#([a-f0-9]{6})([a-f0-9]{2})?$/i,i=/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/,s=/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/,r=/^(\w+)$/,o=[0,0,0,1],a,l,h;if(a=n.match(t)){for(h=a[2],a=a[1],l=0;l<3;l++){var c=l*2;o[l]=parseInt(a.slice(c,c+2),16)}h&&(o[3]=parseInt(h,16)/255)}else if(a=n.match(e)){for(a=a[1],h=a[3],l=0;l<3;l++)o[l]=parseInt(a[l]+a[l],16);h&&(o[3]=parseInt(h+h,16)/255)}else if(a=n.match(i)){for(l=0;l<3;l++)o[l]=parseInt(a[l+1],0);a[4]&&(a[5]?o[3]=parseFloat(a[4])*.01:o[3]=parseFloat(a[4]))}else if(a=n.match(s)){for(l=0;l<3;l++)o[l]=Math.round(parseFloat(a[l+1])*2.55);a[4]&&(a[5]?o[3]=parseFloat(a[4])*.01:o[3]=parseFloat(a[4]))}else return(a=n.match(r))?a[1]==="transparent"?[0,0,0,0]:tt.call(ne,a[1])?(o=ne[a[1]],o[3]=1,o):null:null;for(l=0;l<3;l++)o[l]=X(o[l],0,255);return o[3]=X(o[3],0,1),o};I.get.hsl=function(n){if(!n)return null;var e=/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/,t=n.match(e);if(t){var i=parseFloat(t[4]),s=(parseFloat(t[1])%360+360)%360,r=X(parseFloat(t[2]),0,100),o=X(parseFloat(t[3]),0,100),a=X(isNaN(i)?1:i,0,1);return[s,r,o,a]}return null};I.get.hwb=function(n){if(!n)return null;var e=/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/,t=n.match(e);if(t){var i=parseFloat(t[4]),s=(parseFloat(t[1])%360+360)%360,r=X(parseFloat(t[2]),0,100),o=X(parseFloat(t[3]),0,100),a=X(isNaN(i)?1:i,0,1);return[s,r,o,a]}return null};I.to.hex=function(){var n=oe(arguments);return"#"+he(n[0])+he(n[1])+he(n[2])+(n[3]<1?he(Math.round(n[3]*255)):"")};I.to.rgb=function(){var n=oe(arguments);return n.length<4||n[3]===1?"rgb("+Math.round(n[0])+", "+Math.round(n[1])+", "+Math.round(n[2])+")":"rgba("+Math.round(n[0])+", "+Math.round(n[1])+", "+Math.round(n[2])+", "+n[3]+")"};I.to.rgb.percent=function(){var n=oe(arguments),e=Math.round(n[0]/255*100),t=Math.round(n[1]/255*100),i=Math.round(n[2]/255*100);return n.length<4||n[3]===1?"rgb("+e+"%, "+t+"%, "+i+"%)":"rgba("+e+"%, "+t+"%, "+i+"%, "+n[3]+")"};I.to.hsl=function(){var n=oe(arguments);return n.length<4||n[3]===1?"hsl("+n[0]+", "+n[1]+"%, "+n[2]+"%)":"hsla("+n[0]+", "+n[1]+"%, "+n[2]+"%, "+n[3]+")"};I.to.hwb=function(){var n=oe(arguments),e="";return n.length>=4&&n[3]!==1&&(e=", "+n[3]),"hwb("+n[0]+", "+n[1]+"%, "+n[2]+"%"+e+")"};I.to.keyword=function(n){return it[n.slice(0,3)]};function X(n,e,t){return Math.min(Math.max(e,n),t)}function he(n){var e=Math.round(n).toString(16).toUpperCase();return e.length<2?"0"+e:e}var mi=Je.exports,nt={exports:{}},vi={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},B=vi,st={};for(var ye in B)B.hasOwnProperty(ye)&&(st[B[ye]]=ye);var f=nt.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var H in f)if(f.hasOwnProperty(H)){if(!("channels"in f[H]))throw new Error("missing channels property: "+H);if(!("labels"in f[H]))throw new Error("missing channel labels property: "+H);if(f[H].labels.length!==f[H].channels)throw new Error("channel and label counts mismatch: "+H);var yi=f[H].channels,bi=f[H].labels;delete f[H].channels,delete f[H].labels,Object.defineProperty(f[H],"channels",{value:yi}),Object.defineProperty(f[H],"labels",{value:bi})}f.rgb.hsl=function(n){var e=n[0]/255,t=n[1]/255,i=n[2]/255,s=Math.min(e,t,i),r=Math.max(e,t,i),o=r-s,a,l,h;return r===s?a=0:e===r?a=(t-i)/o:t===r?a=2+(i-e)/o:i===r&&(a=4+(e-t)/o),a=Math.min(a*60,360),a<0&&(a+=360),h=(s+r)/2,r===s?l=0:h<=.5?l=o/(r+s):l=o/(2-r-s),[a,l*100,h*100]};f.rgb.hsv=function(n){var e,t,i,s,r,o=n[0]/255,a=n[1]/255,l=n[2]/255,h=Math.max(o,a,l),c=h-Math.min(o,a,l),d=function(u){return(h-u)/6/c+1/2};return c===0?s=r=0:(r=c/h,e=d(o),t=d(a),i=d(l),o===h?s=i-t:a===h?s=1/3+e-i:l===h&&(s=2/3+t-e),s<0?s+=1:s>1&&(s-=1)),[s*360,r*100,h*100]};f.rgb.hwb=function(n){var e=n[0],t=n[1],i=n[2],s=f.rgb.hsl(n)[0],r=1/255*Math.min(e,Math.min(t,i));return i=1-1/255*Math.max(e,Math.max(t,i)),[s,r*100,i*100]};f.rgb.cmyk=function(n){var e=n[0]/255,t=n[1]/255,i=n[2]/255,s,r,o,a;return a=Math.min(1-e,1-t,1-i),s=(1-e-a)/(1-a)||0,r=(1-t-a)/(1-a)||0,o=(1-i-a)/(1-a)||0,[s*100,r*100,o*100,a*100]};function xi(n,e){return Math.pow(n[0]-e[0],2)+Math.pow(n[1]-e[1],2)+Math.pow(n[2]-e[2],2)}f.rgb.keyword=function(n){var e=st[n];if(e)return e;var t=1/0,i;for(var s in B)if(B.hasOwnProperty(s)){var r=B[s],o=xi(n,r);o<t&&(t=o,i=s)}return i};f.keyword.rgb=function(n){return B[n]};f.rgb.xyz=function(n){var e=n[0]/255,t=n[1]/255,i=n[2]/255;e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92,i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92;var s=e*.4124+t*.3576+i*.1805,r=e*.2126+t*.7152+i*.0722,o=e*.0193+t*.1192+i*.9505;return[s*100,r*100,o*100]};f.rgb.lab=function(n){var e=f.rgb.xyz(n),t=e[0],i=e[1],s=e[2],r,o,a;return t/=95.047,i/=100,s/=108.883,t=t>.008856?Math.pow(t,1/3):7.787*t+16/116,i=i>.008856?Math.pow(i,1/3):7.787*i+16/116,s=s>.008856?Math.pow(s,1/3):7.787*s+16/116,r=116*i-16,o=500*(t-i),a=200*(i-s),[r,o,a]};f.hsl.rgb=function(n){var e=n[0]/360,t=n[1]/100,i=n[2]/100,s,r,o,a,l;if(t===0)return l=i*255,[l,l,l];i<.5?r=i*(1+t):r=i+t-i*t,s=2*i-r,a=[0,0,0];for(var h=0;h<3;h++)o=e+1/3*-(h-1),o<0&&o++,o>1&&o--,6*o<1?l=s+(r-s)*6*o:2*o<1?l=r:3*o<2?l=s+(r-s)*(2/3-o)*6:l=s,a[h]=l*255;return a};f.hsl.hsv=function(n){var e=n[0],t=n[1]/100,i=n[2]/100,s=t,r=Math.max(i,.01),o,a;return i*=2,t*=i<=1?i:2-i,s*=r<=1?r:2-r,a=(i+t)/2,o=i===0?2*s/(r+s):2*t/(i+t),[e,o*100,a*100]};f.hsv.rgb=function(n){var e=n[0]/60,t=n[1]/100,i=n[2]/100,s=Math.floor(e)%6,r=e-Math.floor(e),o=255*i*(1-t),a=255*i*(1-t*r),l=255*i*(1-t*(1-r));switch(i*=255,s){case 0:return[i,l,o];case 1:return[a,i,o];case 2:return[o,i,l];case 3:return[o,a,i];case 4:return[l,o,i];case 5:return[i,o,a]}};f.hsv.hsl=function(n){var e=n[0],t=n[1]/100,i=n[2]/100,s=Math.max(i,.01),r,o,a;return a=(2-t)*i,r=(2-t)*s,o=t*s,o/=r<=1?r:2-r,o=o||0,a/=2,[e,o*100,a*100]};f.hwb.rgb=function(n){var e=n[0]/360,t=n[1]/100,i=n[2]/100,s=t+i,r,o,a,l;s>1&&(t/=s,i/=s),r=Math.floor(6*e),o=1-i,a=6*e-r,r&1&&(a=1-a),l=t+a*(o-t);var h,c,d;switch(r){default:case 6:case 0:h=o,c=l,d=t;break;case 1:h=l,c=o,d=t;break;case 2:h=t,c=o,d=l;break;case 3:h=t,c=l,d=o;break;case 4:h=l,c=t,d=o;break;case 5:h=o,c=t,d=l;break}return[h*255,c*255,d*255]};f.cmyk.rgb=function(n){var e=n[0]/100,t=n[1]/100,i=n[2]/100,s=n[3]/100,r,o,a;return r=1-Math.min(1,e*(1-s)+s),o=1-Math.min(1,t*(1-s)+s),a=1-Math.min(1,i*(1-s)+s),[r*255,o*255,a*255]};f.xyz.rgb=function(n){var e=n[0]/100,t=n[1]/100,i=n[2]/100,s,r,o;return s=e*3.2406+t*-1.5372+i*-.4986,r=e*-.9689+t*1.8758+i*.0415,o=e*.0557+t*-.204+i*1.057,s=s>.0031308?1.055*Math.pow(s,1/2.4)-.055:s*12.92,r=r>.0031308?1.055*Math.pow(r,1/2.4)-.055:r*12.92,o=o>.0031308?1.055*Math.pow(o,1/2.4)-.055:o*12.92,s=Math.min(Math.max(0,s),1),r=Math.min(Math.max(0,r),1),o=Math.min(Math.max(0,o),1),[s*255,r*255,o*255]};f.xyz.lab=function(n){var e=n[0],t=n[1],i=n[2],s,r,o;return e/=95.047,t/=100,i/=108.883,e=e>.008856?Math.pow(e,1/3):7.787*e+16/116,t=t>.008856?Math.pow(t,1/3):7.787*t+16/116,i=i>.008856?Math.pow(i,1/3):7.787*i+16/116,s=116*t-16,r=500*(e-t),o=200*(t-i),[s,r,o]};f.lab.xyz=function(n){var e=n[0],t=n[1],i=n[2],s,r,o;r=(e+16)/116,s=t/500+r,o=r-i/200;var a=Math.pow(r,3),l=Math.pow(s,3),h=Math.pow(o,3);return r=a>.008856?a:(r-16/116)/7.787,s=l>.008856?l:(s-16/116)/7.787,o=h>.008856?h:(o-16/116)/7.787,s*=95.047,r*=100,o*=108.883,[s,r,o]};f.lab.lch=function(n){var e=n[0],t=n[1],i=n[2],s,r,o;return s=Math.atan2(i,t),r=s*360/2/Math.PI,r<0&&(r+=360),o=Math.sqrt(t*t+i*i),[e,o,r]};f.lch.lab=function(n){var e=n[0],t=n[1],i=n[2],s,r,o;return o=i/360*2*Math.PI,s=t*Math.cos(o),r=t*Math.sin(o),[e,s,r]};f.rgb.ansi16=function(n){var e=n[0],t=n[1],i=n[2],s=1 in arguments?arguments[1]:f.rgb.hsv(n)[2];if(s=Math.round(s/50),s===0)return 30;var r=30+(Math.round(i/255)<<2|Math.round(t/255)<<1|Math.round(e/255));return s===2&&(r+=60),r};f.hsv.ansi16=function(n){return f.rgb.ansi16(f.hsv.rgb(n),n[2])};f.rgb.ansi256=function(n){var e=n[0],t=n[1],i=n[2];if(e===t&&t===i)return e<8?16:e>248?231:Math.round((e-8)/247*24)+232;var s=16+36*Math.round(e/255*5)+6*Math.round(t/255*5)+Math.round(i/255*5);return s};f.ansi16.rgb=function(n){var e=n%10;if(e===0||e===7)return n>50&&(e+=3.5),e=e/10.5*255,[e,e,e];var t=(~~(n>50)+1)*.5,i=(e&1)*t*255,s=(e>>1&1)*t*255,r=(e>>2&1)*t*255;return[i,s,r]};f.ansi256.rgb=function(n){if(n>=232){var e=(n-232)*10+8;return[e,e,e]}n-=16;var t,i=Math.floor(n/36)/5*255,s=Math.floor((t=n%36)/6)/5*255,r=t%6/5*255;return[i,s,r]};f.rgb.hex=function(n){var e=((Math.round(n[0])&255)<<16)+((Math.round(n[1])&255)<<8)+(Math.round(n[2])&255),t=e.toString(16).toUpperCase();return"000000".substring(t.length)+t};f.hex.rgb=function(n){var e=n.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!e)return[0,0,0];var t=e[0];e[0].length===3&&(t=t.split("").map(function(a){return a+a}).join(""));var i=parseInt(t,16),s=i>>16&255,r=i>>8&255,o=i&255;return[s,r,o]};f.rgb.hcg=function(n){var e=n[0]/255,t=n[1]/255,i=n[2]/255,s=Math.max(Math.max(e,t),i),r=Math.min(Math.min(e,t),i),o=s-r,a,l;return o<1?a=r/(1-o):a=0,o<=0?l=0:s===e?l=(t-i)/o%6:s===t?l=2+(i-e)/o:l=4+(e-t)/o+4,l/=6,l%=1,[l*360,o*100,a*100]};f.hsl.hcg=function(n){var e=n[1]/100,t=n[2]/100,i=1,s=0;return t<.5?i=2*e*t:i=2*e*(1-t),i<1&&(s=(t-.5*i)/(1-i)),[n[0],i*100,s*100]};f.hsv.hcg=function(n){var e=n[1]/100,t=n[2]/100,i=e*t,s=0;return i<1&&(s=(t-i)/(1-i)),[n[0],i*100,s*100]};f.hcg.rgb=function(n){var e=n[0]/360,t=n[1]/100,i=n[2]/100;if(t===0)return[i*255,i*255,i*255];var s=[0,0,0],r=e%1*6,o=r%1,a=1-o,l=0;switch(Math.floor(r)){case 0:s[0]=1,s[1]=o,s[2]=0;break;case 1:s[0]=a,s[1]=1,s[2]=0;break;case 2:s[0]=0,s[1]=1,s[2]=o;break;case 3:s[0]=0,s[1]=a,s[2]=1;break;case 4:s[0]=o,s[1]=0,s[2]=1;break;default:s[0]=1,s[1]=0,s[2]=a}return l=(1-t)*i,[(t*s[0]+l)*255,(t*s[1]+l)*255,(t*s[2]+l)*255]};f.hcg.hsv=function(n){var e=n[1]/100,t=n[2]/100,i=e+t*(1-e),s=0;return i>0&&(s=e/i),[n[0],s*100,i*100]};f.hcg.hsl=function(n){var e=n[1]/100,t=n[2]/100,i=t*(1-e)+.5*e,s=0;return i>0&&i<.5?s=e/(2*i):i>=.5&&i<1&&(s=e/(2*(1-i))),[n[0],s*100,i*100]};f.hcg.hwb=function(n){var e=n[1]/100,t=n[2]/100,i=e+t*(1-e);return[n[0],(i-e)*100,(1-i)*100]};f.hwb.hcg=function(n){var e=n[1]/100,t=n[2]/100,i=1-t,s=i-e,r=0;return s<1&&(r=(i-s)/(1-s)),[n[0],s*100,r*100]};f.apple.rgb=function(n){return[n[0]/65535*255,n[1]/65535*255,n[2]/65535*255]};f.rgb.apple=function(n){return[n[0]/255*65535,n[1]/255*65535,n[2]/255*65535]};f.gray.rgb=function(n){return[n[0]/100*255,n[0]/100*255,n[0]/100*255]};f.gray.hsl=f.gray.hsv=function(n){return[0,0,n[0]]};f.gray.hwb=function(n){return[0,100,n[0]]};f.gray.cmyk=function(n){return[0,0,0,n[0]]};f.gray.lab=function(n){return[n[0],0,0]};f.gray.hex=function(n){var e=Math.round(n[0]/100*255)&255,t=(e<<16)+(e<<8)+e,i=t.toString(16).toUpperCase();return"000000".substring(i.length)+i};f.rgb.gray=function(n){var e=(n[0]+n[1]+n[2])/3;return[e/255*100]};var rt=nt.exports,ue=rt;function Ei(){for(var n={},e=Object.keys(ue),t=e.length,i=0;i<t;i++)n[e[i]]={distance:-1,parent:null};return n}function wi(n){var e=Ei(),t=[n];for(e[n].distance=0;t.length;)for(var i=t.pop(),s=Object.keys(ue[i]),r=s.length,o=0;o<r;o++){var a=s[o],l=e[a];l.distance===-1&&(l.distance=e[i].distance+1,l.parent=i,t.unshift(a))}return e}function ki(n,e){return function(t){return e(n(t))}}function Ci(n,e){for(var t=[e[n].parent,n],i=ue[e[n].parent][n],s=e[n].parent;e[s].parent;)t.unshift(e[s].parent),i=ki(ue[e[s].parent][s],i),s=e[s].parent;return i.conversion=t,i}var Mi=function(n){for(var e=wi(n),t={},i=Object.keys(e),s=i.length,r=0;r<s;r++){var o=i[r],a=e[o];a.parent!==null&&(t[o]=Ci(o,e))}return t},we=rt,Ri=Mi,Z={},Pi=Object.keys(we);function Si(n){var e=function(t){return t==null?t:(arguments.length>1&&(t=Array.prototype.slice.call(arguments)),n(t))};return"conversion"in n&&(e.conversion=n.conversion),e}function _i(n){var e=function(t){if(t==null)return t;arguments.length>1&&(t=Array.prototype.slice.call(arguments));var i=n(t);if(typeof i=="object")for(var s=i.length,r=0;r<s;r++)i[r]=Math.round(i[r]);return i};return"conversion"in n&&(e.conversion=n.conversion),e}Pi.forEach(function(n){Z[n]={},Object.defineProperty(Z[n],"channels",{value:we[n].channels}),Object.defineProperty(Z[n],"labels",{value:we[n].labels});var e=Ri(n),t=Object.keys(e);t.forEach(function(i){var s=e[i];Z[n][i]=_i(s),Z[n][i].raw=Si(s)})});var Ti=Z,ie=mi,L=Ti,Pe=[].slice,ot=["keyword","gray","hex"],ke={};Object.keys(L).forEach(function(n){ke[Pe.call(L[n].labels).sort().join("")]=n});var ge={};function F(n,e){if(!(this instanceof F))return new F(n,e);if(e&&e in ot&&(e=null),e&&!(e in L))throw new Error("Unknown model: "+e);var t,i;if(n==null)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(n instanceof F)this.model=n.model,this.color=n.color.slice(),this.valpha=n.valpha;else if(typeof n=="string"){var s=ie.get(n);if(s===null)throw new Error("Unable to parse color from string: "+n);this.model=s.model,i=L[this.model].channels,this.color=s.value.slice(0,i),this.valpha=typeof s.value[i]=="number"?s.value[i]:1}else if(n.length){this.model=e||"rgb",i=L[this.model].channels;var r=Pe.call(n,0,i);this.color=Ce(r,i),this.valpha=typeof n[i]=="number"?n[i]:1}else if(typeof n=="number")n&=16777215,this.model="rgb",this.color=[n>>16&255,n>>8&255,n&255],this.valpha=1;else{this.valpha=1;var o=Object.keys(n);"alpha"in n&&(o.splice(o.indexOf("alpha"),1),this.valpha=typeof n.alpha=="number"?n.alpha:0);var a=o.sort().join("");if(!(a in ke))throw new Error("Unable to parse color from object: "+JSON.stringify(n));this.model=ke[a];var l=L[this.model].labels,h=[];for(t=0;t<l.length;t++)h.push(n[l[t]]);this.color=Ce(h)}if(ge[this.model])for(i=L[this.model].channels,t=0;t<i;t++){var c=ge[this.model][t];c&&(this.color[t]=c(this.color[t]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}F.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(n){var e=this.model in ie.to?this:this.rgb();e=e.round(typeof n=="number"?n:1);var t=e.valpha===1?e.color:e.color.concat(this.valpha);return ie.to[e.model](t)},percentString:function(n){var e=this.rgb().round(typeof n=="number"?n:1),t=e.valpha===1?e.color:e.color.concat(this.valpha);return ie.to.rgb.percent(t)},array:function(){return this.valpha===1?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var n={},e=L[this.model].channels,t=L[this.model].labels,i=0;i<e;i++)n[t[i]]=this.color[i];return this.valpha!==1&&(n.alpha=this.valpha),n},unitArray:function(){var n=this.rgb().color;return n[0]/=255,n[1]/=255,n[2]/=255,this.valpha!==1&&n.push(this.valpha),n},unitObject:function(){var n=this.rgb().object();return n.r/=255,n.g/=255,n.b/=255,this.valpha!==1&&(n.alpha=this.valpha),n},round:function(n){return n=Math.max(n||0,0),new F(this.color.map(zi(n)).concat(this.valpha),this.model)},alpha:function(n){return arguments.length?new F(this.color.concat(Math.max(0,Math.min(1,n))),this.model):this.valpha},red:R("rgb",0,_(255)),green:R("rgb",1,_(255)),blue:R("rgb",2,_(255)),hue:R(["hsl","hsv","hsl","hwb","hcg"],0,function(n){return(n%360+360)%360}),saturationl:R("hsl",1,_(100)),lightness:R("hsl",2,_(100)),saturationv:R("hsv",1,_(100)),value:R("hsv",2,_(100)),chroma:R("hcg",1,_(100)),gray:R("hcg",2,_(100)),white:R("hwb",1,_(100)),wblack:R("hwb",2,_(100)),cyan:R("cmyk",0,_(100)),magenta:R("cmyk",1,_(100)),yellow:R("cmyk",2,_(100)),black:R("cmyk",3,_(100)),x:R("xyz",0,_(100)),y:R("xyz",1,_(100)),z:R("xyz",2,_(100)),l:R("lab",0,_(100)),a:R("lab",1),b:R("lab",2),keyword:function(n){return arguments.length?new F(n):L[this.model].keyword(this.color)},hex:function(n){return arguments.length?new F(n):ie.to.hex(this.rgb().round().color)},rgbNumber:function(){var n=this.rgb().color;return(n[0]&255)<<16|(n[1]&255)<<8|n[2]&255},luminosity:function(){for(var n=this.rgb().color,e=[],t=0;t<n.length;t++){var i=n[t]/255;e[t]=i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4)}return .2126*e[0]+.7152*e[1]+.0722*e[2]},contrast:function(n){var e=this.luminosity(),t=n.luminosity();return e>t?(e+.05)/(t+.05):(t+.05)/(e+.05)},level:function(n){var e=this.contrast(n);return e>=7.1?"AAA":e>=4.5?"AA":""},isDark:function(){var n=this.rgb().color,e=(n[0]*299+n[1]*587+n[2]*114)/1e3;return e<128},isLight:function(){return!this.isDark()},negate:function(){for(var n=this.rgb(),e=0;e<3;e++)n.color[e]=255-n.color[e];return n},lighten:function(n){var e=this.hsl();return e.color[2]+=e.color[2]*n,e},darken:function(n){var e=this.hsl();return e.color[2]-=e.color[2]*n,e},saturate:function(n){var e=this.hsl();return e.color[1]+=e.color[1]*n,e},desaturate:function(n){var e=this.hsl();return e.color[1]-=e.color[1]*n,e},whiten:function(n){var e=this.hwb();return e.color[1]+=e.color[1]*n,e},blacken:function(n){var e=this.hwb();return e.color[2]+=e.color[2]*n,e},grayscale:function(){var n=this.rgb().color,e=n[0]*.3+n[1]*.59+n[2]*.11;return F.rgb(e,e,e)},fade:function(n){return this.alpha(this.valpha-this.valpha*n)},opaquer:function(n){return this.alpha(this.valpha+this.valpha*n)},rotate:function(n){var e=this.hsl(),t=e.color[0];return t=(t+n)%360,t=t<0?360+t:t,e.color[0]=t,e},mix:function(n,e){if(!n||!n.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof n);var t=n.rgb(),i=this.rgb(),s=e===void 0?.5:e,r=2*s-1,o=t.alpha()-i.alpha(),a=((r*o===-1?r:(r+o)/(1+r*o))+1)/2,l=1-a;return F.rgb(a*t.red()+l*i.red(),a*t.green()+l*i.green(),a*t.blue()+l*i.blue(),t.alpha()*s+i.alpha()*(1-s))}};Object.keys(L).forEach(function(n){if(ot.indexOf(n)===-1){var e=L[n].channels;F.prototype[n]=function(){if(this.model===n)return new F(this);if(arguments.length)return new F(arguments,n);var t=typeof arguments[e]=="number"?e:this.valpha;return new F(Hi(L[this.model][n].raw(this.color)).concat(t),n)},F[n]=function(t){return typeof t=="number"&&(t=Ce(Pe.call(arguments),e)),new F(t,n)}}});function Fi(n,e){return Number(n.toFixed(e))}function zi(n){return function(e){return Fi(e,n)}}function R(n,e,t){return n=Array.isArray(n)?n:[n],n.forEach(function(i){(ge[i]||(ge[i]=[]))[e]=t}),n=n[0],function(i){var s;return arguments.length?(t&&(i=t(i)),s=this[n](),s.color[e]=i,s):(s=this[n]().color[e],t&&(s=t(s)),s)}}function _(n){return function(e){return Math.max(0,Math.min(n,e))}}function Hi(n){return Array.isArray(n)?n:[n]}function Ce(n,e){for(var t=0;t<e;t++)typeof n[t]!="number"&&(n[t]=0);return n}var Li=F;const pe=Ye(Li);class Y extends re.EventEmitter{constructor(e){super(),this.name=e}get fullHeight(){return typeof this.height=="number"?this.height:0}init(e,t){this.renderEngine=e,this.interactionsEngine=t}}const D=(n,e={})=>Object.keys(n).reduce((t,i)=>(e[i]?t[i]=e[i]:t[i]=n[i],t),{}),Le=n=>typeof n=="number",W=n=>n[n.length-1],at=(n,e,t)=>{const i=n*Math.SQRT2/2;let s=[];switch(t){case"top":s=[{x:0,y:e},{x:n/2,y:0},{x:n,y:e}];break;case"bottom":s=[{x:0,y:0},{x:n,y:0},{x:n/2,y:e}];break;case"left":s=[{x:e,y:0},{x:e,y:n},{x:0,y:n/2}];break;case"right":s=[{x:0,y:0},{x:0,y:n},{x:e,y:n/2}];break;case"top-left":s=[{x:0,y:0},{x:i,y:0},{x:0,y:i}];break;case"top-right":s=[{x:0,y:0},{x:i,y:0},{x:i,y:i}];break;case"bottom-left":s=[{x:0,y:0},{x:0,y:i},{x:i,y:i}];break;case"bottom-right":s=[{x:i,y:0},{x:0,y:i},{x:i,y:i}];break}return s},lt=1,ht=.25,Ii=lt*2+ht,ct=(n,e,t=null,i=0)=>{n.forEach(s=>{const r=e(s,t,i);s.children&&ct(s.children,e,r||s,i+1)})},dt=n=>{const e=[];let t=0;return ct(n,(i,s,r)=>{const o={source:i,end:i.start+i.duration,parent:s,level:r,index:t++};return e.push(o),o}),e.sort((i,s)=>i.level-s.level||i.source.start-s.source.start)},ut=n=>{let e=!0,t=0,i=0;return n.forEach(({source:{start:s},end:r})=>{e?(t=s,i=r,e=!1):(t=t<s?t:s,i=i>r?i:r)}),{min:t,max:i}},Ai=n=>{const e=n[0],t=W(n);return t.source.start+t.source.duration-e.source.start},Di=(n,e,t)=>n.source.start<t&&n.end>e||n.source.start>e&&n.end<t,$i=(n,e,t)=>n.start<t&&n.end>e||n.start>e&&n.end<t,Oi=(n,e)=>n.source.color===e.source.color&&n.source.pattern===e.source.pattern&&n.source.type===e.source.type;function gt(n,e=Oi){return n.reduce((t,i)=>{const s=W(t),r=s&&W(s);return r&&r.level===i.level&&e(r,i)?s.push(i):t.push([i]),t},[]).filter(t=>t.length).map(t=>({nodes:t}))}const Se=(n,e,t=0,i=0,s=ht,r=lt)=>{let o=null,a=null,l=0;return n.reduce((h,{nodes:c})=>{o=null,a=null,l=0;for(const d of c)Di(d,t,i)&&(o&&!a||o&&a&&(d.source.start-(a.source.start+a.source.duration))*e<s&&d.source.duration*e<r&&a.source.duration*e<r?(o[l]=d,l++):(o=[d],l=1,h.push(o)),a=d);return h},[]).map(h=>{var c;const d=h[0],u=Ai(h),p=(c=h.find(g=>g.source.badge))===null||c===void 0?void 0:c.source.badge;return{start:d.source.start,end:d.source.start+u,duration:u,type:d.source.type,color:d.source.color,pattern:d.source.pattern,level:d.level,badge:p,nodes:h}})},ft=(n,e,t,i,s,r)=>n.reduce((o,a)=>($i(a,t,i)&&(a.duration*e<=Ii?o.push(a):o.push(...Se([a],e,t,i,s,r))),o),[]),Ie=pe.hsl(180,30,70);class Wi extends Y{constructor({data:e,colors:t={},name:i="flameChartPlugin"}){super(i),this.height="flexible",this.flatTree=[],this.positionY=0,this.colors={},this.selectedRegion=null,this.hoveredRegion=null,this.lastRandomColor=Ie,this.metaClusterizedFlatTree=[],this.actualClusterizedFlatTree=[],this.initialClusterizedFlatTree=[],this.lastUsedColor=null,this.renderChartTimeout=-1,this.data=e,this.userColors=t,this.parseData(),this.reset()}init(e,t){super.init(e,t),this.interactionsEngine.on("change-position",this.handlePositionChange.bind(this)),this.interactionsEngine.on("select",this.handleSelect.bind(this)),this.interactionsEngine.on("hover",this.handleHover.bind(this)),this.interactionsEngine.on("up",this.handleMouseUp.bind(this)),this.initData()}handlePositionChange({deltaX:e,deltaY:t}){const i=this.positionY,s=this.renderEngine.parent.positionX;this.interactionsEngine.setCursor("grabbing"),this.positionY+t>=0?this.setPositionY(this.positionY+t):this.setPositionY(0),this.renderEngine.tryToChangePosition(e),(s!==this.renderEngine.parent.positionX||i!==this.positionY)&&this.renderEngine.parent.render()}handleMouseUp(){this.interactionsEngine.clearCursor()}setPositionY(e){this.positionY=e}reset(){this.colors={},this.lastRandomColor=Ie,this.positionY=0,this.selectedRegion=null}calcMinMax(){const{flatTree:e}=this,{min:t,max:i}=ut(e);this.min=t,this.max=i}handleSelect(e){var t,i;const s=this.findNodeInCluster(e);this.selectedRegion!==s&&(this.selectedRegion=s,this.renderEngine.render(),this.emit("select",{node:(i=(t=this.selectedRegion)===null||t===void 0?void 0:t.data)!==null&&i!==void 0?i:null,type:"flame-chart-node"}))}handleHover(e){this.hoveredRegion=this.findNodeInCluster(e)}findNodeInCluster(e){const t=this.interactionsEngine.getMouse();if(e&&e.type==="cluster"){const i=e.data.nodes.find(({level:s,source:{start:r,duration:o}})=>{const{x:a,y:l,w:h}=this.calcRect(r,o,s);return t.x>=a&&t.x<=a+h&&t.y>=l&&t.y<=l+this.renderEngine.blockHeight});if(i)return{data:i,type:"node"}}return null}getColor(e="_default",t){if(t)return t;if(this.colors[e])return this.colors[e];if(this.userColors[e]){const i=new pe(this.userColors[e]);return this.colors[e]=i.rgb().toString(),this.colors[e]}return this.lastRandomColor=this.lastRandomColor.rotate(27),this.colors[e]=this.lastRandomColor.rgb().toString(),this.colors[e]}setData(e){this.data=e,this.parseData(),this.initData(),this.reset(),this.renderEngine.recalcMinMax(),this.renderEngine.resetParentView()}parseData(){this.flatTree=dt(this.data),this.calcMinMax()}initData(){this.metaClusterizedFlatTree=gt(this.flatTree),this.initialClusterizedFlatTree=Se(this.metaClusterizedFlatTree,this.renderEngine.zoom,this.min,this.max),this.reclusterizeClusteredFlatTree()}reclusterizeClusteredFlatTree(){this.actualClusterizedFlatTree=ft(this.initialClusterizedFlatTree,this.renderEngine.zoom,this.renderEngine.positionX,this.renderEngine.positionX+this.renderEngine.getRealView())}calcRect(e,t,i){const s=t*this.renderEngine.zoom;return{x:this.renderEngine.timeToPosition(e),y:i*(this.renderEngine.blockHeight+1)-this.positionY,w:s<=.1?.1:s>=3?s-1:s-s/3}}renderTooltip(){if(this.hoveredRegion){if(this.renderEngine.options.tooltip===!1)return!0;if(typeof this.renderEngine.options.tooltip=="function")this.renderEngine.options.tooltip(this.hoveredRegion,this.renderEngine,this.interactionsEngine.getGlobalMouse());else{const{data:{source:{start:e,duration:t,name:i,children:s}}}=this.hoveredRegion,r=this.renderEngine.getTimeUnits(),o=t-(s?s.reduce((d,{duration:u})=>d+u,0):0),a=this.renderEngine.getAccuracy()+2,l=`${i}`,h=`duration: ${t.toFixed(a)} ${r} ${s!=null&&s.length?`(self ${o.toFixed(a)} ${r})`:""}`,c=`start: ${e.toFixed(a)}`;this.renderEngine.renderTooltipFromData([{text:l},{text:h},{text:c}],this.interactionsEngine.getGlobalMouse())}return!0}return!1}render(){const{width:e,blockHeight:t,height:i,minTextWidth:s}=this.renderEngine;this.lastUsedColor=null,this.reclusterizeClusteredFlatTree();const r=l=>h=>{const{start:c,duration:d,level:u}=h,{x:p,y:g,w:x}=this.calcRect(c,d,u);p+x>0&&p<e&&g+t>0&&g<i&&l(h,p,g,x)},o=(l,h,c,d)=>{const{type:u,nodes:p,color:g,pattern:x,badge:v}=l,m=this.interactionsEngine.getMouse();if(m.y>=c&&m.y<=c+t&&a(l,h,c,d),d>=.25&&(this.renderEngine.addRect({color:this.getColor(u,g),pattern:x,x:h,y:c,w:d},0),v)){const y=`node-badge-${v}`,E=this.renderEngine.styles.badgeSize*2/Math.SQRT2;this.renderEngine.createCachedDefaultPattern({name:y,type:"triangles",config:{color:v,width:E,align:"top",direction:"top-left"}}),this.renderEngine.addRect({pattern:y,color:"transparent",x:h,y:c,w:Math.min(E,d)},1)}d>=s&&p.length===1&&this.renderEngine.addText({text:p[0].source.name,x:h,y:c,w:d},2)},a=(l,h,c,d)=>{this.interactionsEngine.addHitRegion("cluster",l,h,c,d,t)};if(this.actualClusterizedFlatTree.forEach(r(o)),this.selectedRegion&&this.selectedRegion.type==="node"){const{source:{start:l,duration:h},level:c}=this.selectedRegion.data,{x:d,y:u,w:p}=this.calcRect(l,h,c);this.renderEngine.addStroke({color:"green",x:d,y:u,w:p,h:this.renderEngine.blockHeight},2)}clearTimeout(this.renderChartTimeout),this.renderChartTimeout=window.setTimeout(()=>{this.interactionsEngine.clearHitRegions(),this.actualClusterizedFlatTree.forEach(r(a))},16)}}const Ae={font:"10px sans-serif",fontColor:"black"};class Xi extends Y{constructor(e={}){super("timeGridPlugin"),this.styles=Ae,this.height=0,this.setSettings(e)}setSettings({styles:e}){this.styles=D(Ae,e),this.renderEngine&&this.overrideEngineSettings()}overrideEngineSettings(){this.renderEngine.setSettingsOverrides({styles:this.styles}),this.height=Math.round(this.renderEngine.charHeight+10)}init(e,t){super.init(e,t),this.overrideEngineSettings()}render(){return this.renderEngine.parent.timeGrid.renderTimes(this.renderEngine),this.renderEngine.parent.timeGrid.renderLines(0,this.renderEngine.height,this.renderEngine),!0}}class Gi extends Y{constructor({data:e,name:t="marksPlugin"}){super(t),this.hoveredRegion=null,this.selectedRegion=null,this.marks=this.prepareMarks(e),this.calcMinMax()}calcMinMax(){const{marks:e}=this;e.length&&(this.min=e.reduce((t,{timestamp:i})=>i<t?i:t,e[0].timestamp),this.max=e.reduce((t,{timestamp:i})=>i>t?i:t,e[0].timestamp))}init(e,t){super.init(e,t),this.interactionsEngine.on("hover",this.handleHover.bind(this)),this.interactionsEngine.on("select",this.handleSelect.bind(this))}handleHover(e){this.hoveredRegion=e}handleSelect(e){var t;this.selectedRegion!==e&&(this.selectedRegion=e,this.emit("select",{node:(t=e==null?void 0:e.data)!==null&&t!==void 0?t:null,type:"mark"}),this.renderEngine.render())}get height(){return this.renderEngine.blockHeight+2}prepareMarks(e){return e.map(({color:t,...i})=>({...i,color:new pe(t).alpha(.7).rgb().toString()})).sort((t,i)=>t.timestamp-i.timestamp)}setMarks(e){this.marks=this.prepareMarks(e),this.calcMinMax(),this.renderEngine.recalcMinMax(),this.renderEngine.resetParentView()}calcMarksBlockPosition(e,t){return e>0&&t>e?t:e}render(){this.marks.reduce((e,t)=>{const{timestamp:i,color:s,shortName:r}=t,{width:o}=this.renderEngine.ctx.measureText(r),a=o+this.renderEngine.blockPaddingLeftRight*2,l=this.renderEngine.timeToPosition(i),h=this.calcMarksBlockPosition(l,e);return this.renderEngine.addRect({color:s,x:h,y:1,w:a}),this.renderEngine.addText({text:r,x:h,y:1,w:a}),this.interactionsEngine.addHitRegion("timestamp",t,h,1,a,this.renderEngine.blockHeight),h+a},0)}postRender(){this.marks.forEach(e=>{const{timestamp:t,color:i}=e,s=this.renderEngine.timeToPosition(t);this.renderEngine.parent.setCtxValue("strokeStyle",i),this.renderEngine.parent.setCtxValue("lineWidth",1),this.renderEngine.parent.callCtx("setLineDash",[8,7]),this.renderEngine.parent.ctx.beginPath(),this.renderEngine.parent.ctx.moveTo(s,this.renderEngine.position),this.renderEngine.parent.ctx.lineTo(s,this.renderEngine.parent.height),this.renderEngine.parent.ctx.stroke()})}renderTooltip(){if(this.hoveredRegion&&this.hoveredRegion.type==="timestamp"){if(this.renderEngine.options.tooltip===!1)return!0;if(typeof this.renderEngine.options.tooltip=="function")this.renderEngine.options.tooltip(this.hoveredRegion,this.renderEngine,this.interactionsEngine.getGlobalMouse());else{const{data:{fullName:e,timestamp:t}}=this.hoveredRegion,i=this.renderEngine.getAccuracy()+2,s=`${e}`,r=`${t.toFixed(i)} ${this.renderEngine.timeUnits}`;this.renderEngine.renderTooltipFromData([{text:s},{text:r}],this.interactionsEngine.getGlobalMouse())}return!0}return!1}}const Ui=85,De={color:"rgba(90,90,90,0.20)"};class pt{constructor(e){this.styles=De,this.timeUnits="ms",this.start=0,this.end=0,this.accuracy=0,this.delta=0,this.setSettings(e)}setDefaultRenderEngine(e){this.renderEngine=e,this.timeUnits=this.renderEngine.getTimeUnits()}setSettings({styles:e}){this.styles=D(De,e),this.renderEngine&&(this.timeUnits=this.renderEngine.getTimeUnits())}recalc(){const e=this.renderEngine.max-this.renderEngine.min,t=this.renderEngine.width/Ui,i=e/t,s=this.renderEngine.getRealView(),r=s/(e||1);this.delta=i/Math.pow(2,Math.floor(Math.log2(1/r))),this.start=Math.floor((this.renderEngine.positionX-this.renderEngine.min)/this.delta),this.end=Math.ceil(s/this.delta)+this.start,this.accuracy=this.calcNumberFix()}calcNumberFix(){var e;const t=(this.delta/2).toString();if(t.includes("e"))return Number((e=t.match(/\d+$/))===null||e===void 0?void 0:e[0]);const i=t.match(/(0\.0*)/);return i?i[0].length-1:0}getTimelineAccuracy(){return this.accuracy}forEachTime(e){for(let t=this.start;t<=this.end;t++){const i=t*this.delta+this.renderEngine.min,s=this.renderEngine.timeToPosition(Number(i.toFixed(this.accuracy)));e(s,i)}}renderLines(e,t,i=this.renderEngine){i.setCtxValue("fillStyle",this.styles.color),this.forEachTime(s=>{i.fillRect(s,e,1,t)})}renderTimes(e=this.renderEngine){e.setCtxValue("fillStyle",e.styles.fontColor),e.setCtxFont(e.styles.font),this.forEachTime((t,i)=>{e.fillText(i.toFixed(this.accuracy)+this.timeUnits,t+e.blockPaddingLeftRight,e.charHeight)})}}function ce(n,e,t,i){return n.length?n.reduce((s,{[e]:r})=>t(s,r),n[0][e]):i}const mt=n=>n.items.map(({name:e,intervals:t,timing:i,meta:s},r)=>{const a=(typeof t=="string"?n.intervals[t]:t).map(({start:p,end:g,...x})=>({start:typeof p=="string"?i[p]:p,end:typeof g=="string"?i[g]:g,...x})).filter(({start:p,end:g})=>typeof p=="number"&&typeof g=="number"),l=a.filter(({type:p})=>p==="block"),h=ce(l,"start",Math.min,0),c=ce(l,"end",Math.max,0),d=ce(a,"start",Math.min,0),u=ce(a,"end",Math.max,0);return{intervals:a,textBlock:{start:h,end:c},name:e,timing:i,min:d,max:u,index:r,meta:s}}).filter(({intervals:e})=>e.length).sort((e,t)=>e.min-t.min||t.max-e.max),Vi=(n,e,t,i)=>i-(n-e)*t,Ni={fillColor:"rgba(0, 0, 0, 0.1)",lineWidth:1,lineDash:[],lineColor:"rgba(0, 0, 0, 0.5)",type:"smooth"},vt=n=>{const e=[],t=n.map(o=>{var a;return{group:o.units&&!o.group?o.units:"default",...o,style:{lineWidth:1,fillColor:"rgba(0, 0, 0, 0.15)",lineColor:"rgba(0, 0, 0, 0.20)",lineDash:[],type:"smooth",...(a=o.style)!==null&&a!==void 0?a:{}}}}),i=t.reduce((o,{points:a,group:l,min:h,max:c},d)=>(o[l]||(o[l]={min:h??a[0][1],max:c??a[0][1]}),e[d]={start:a[0][0],end:W(a)[0]},a.forEach(([u,p])=>{h===void 0&&(o[l].min=Math.min(o[l].min,p)),c===void 0&&(o[l].max=Math.max(o[l].max,p)),e[d].start=Math.min(e[d].start,u),e[d].end=Math.max(e[d].end,u)}),o),{}),s=Math.min(...e.map(({start:o})=>o)),r=Math.max(...e.map(({end:o})=>o));return{summary:i,total:{min:s,max:r},timeseries:t,timeboxes:e}},yt=(n,e,t)=>{var i,s;return e.dynamicMinMax?n.reduce((r,[,o])=>(r.min=Math.min(r.min,o),r.max=Math.max(r.max,o),r),{min:(i=e.min)!==null&&i!==void 0?i:1/0,max:(s=e.max)!==null&&s!==void 0?s:-1/0}):e.group?t[e.group]:{min:-1/0,max:1/0}},bt=(n,{timeseries:e})=>{const t=e.reduce((i,{points:s,units:r,name:o,group:a})=>{const l=Ki(s,n),c=a!==r&&a!=="default"?a:"default";let d="";return l&&(o&&(d+=o+": "),d+=l[1].toFixed(2),r&&(d+=r)),i[c]||(i[c]=[]),i[c].push(d),i},{});return Object.entries(t).reduce((i,[s,r])=>(s!=="default"&&i.push({text:s,color:"black"}),r.forEach(o=>{i.push({text:o})}),i),[])},de=({engine:n,points:e,style:t,min:i,max:s})=>{const r={...Ni,...t??{}};n.setCtxValue("strokeStyle",r.lineColor),n.setCtxValue("fillStyle",r.fillColor),n.setCtxValue("lineWidth",r.lineWidth),n.callCtx("setLineDash",r.lineDash),n.ctx.beginPath();const o=(n.height-n.charHeight-4)/(s-i);if(e.length>1){const a=e.map(([l,h])=>[n.timeToPosition(l),Vi(h,i,o,n.height)]);if(n.ctx.moveTo(a[0][0],n.height),n.ctx.lineTo(a[0][0],a[0][1]),r.type==="smooth"||!r.type){for(let c=1;c<a.length-2;c++){const d=(a[c][0]+a[c+1][0])/2,u=(a[c][1]+a[c+1][1])/2;n.ctx.quadraticCurveTo(a[c][0],a[c][1],d,u)}const l=a[a.length-2],h=W(a);n.ctx.quadraticCurveTo(l[0],l[1],h[0],h[1]),n.ctx.quadraticCurveTo(h[0],h[1],h[0],n.height)}else if(r.type==="line")for(let l=1;l<a.length;l++)n.ctx.lineTo(a[l][0],a[l][1]);else if(r.type==="bar"){for(let l=0;l<a.length;l++){const h=a[l],c=a[l-1]||h,d=a[l+1],u=(h[0]-c[0])/2,p=d?(d[0]-h[0])/2:u;n.ctx.lineTo(c[0]+u,h[1]),n.ctx.lineTo(h[0]+p,h[1]),d?n.ctx.lineTo(h[0]+p,d[1]):n.ctx.lineTo(h[0]+p,n.height)}n.ctx.lineTo(W(a)[0],n.height)}}n.ctx.closePath(),n.ctx.stroke(),n.ctx.fill()},Ki=(n,e,t=!0)=>{if(n[0][0]>=e)return t?n[0]:null;if(W(n)[0]<=e)return t?W(n):null;if(n.length<=1)return n[0];let i=0,s=n.length-1;for(;i<=s;){const r=Math.ceil((s+i)/2);if(e>=n[r-1][0]&&e<=n[r][0]){const o=Math.abs(e-n[r-1][0])<Math.abs(e-n[r][0])?r-1:r;return n[o]}n[r][0]<e?i=r+1:s=r-1}return null},$e=2,Oe={font:"9px sans-serif",fontColor:"black",overlayColor:"rgba(112, 112, 112, 0.5)",graphStrokeColor:"rgba(0, 0, 0, 0.10)",graphFillColor:"rgba(0, 0, 0, 0.15)",flameChartGraphType:"smooth",waterfallStrokeOpacity:.4,waterfallFillOpacity:.35,waterfallGraphType:"smooth",bottomLineColor:"rgba(0, 0, 0, 0.25)",knobColor:"rgb(131, 131, 131)",knobStrokeColor:"white",knobSize:6,height:60,backgroundColor:"white"};class qi extends Y{constructor({waterfall:e,flameChartNodes:t,timeseries:i,settings:s,name:r="timeframeSelectorPlugin"}){super(r),this.styles=Oe,this.height=0,this.leftKnobMoving=!1,this.rightKnobMoving=!1,this.selectingActive=!1,this.startSelectingPosition=0,this.actualClusters=[],this.clusters=[],this.flameChartMaxLevel=0,this.flameChartDots=[],this.waterfallDots=[],this.waterfallMaxLevel=0,this.actualClusterizedFlatTree=[],this.hoveredRegion=null,this.flameChartNodes=t,this.waterfall=e,this.timeseries=i,this.shouldRender=!0,this.setSettings(s)}init(e,t){super.init(e,t),this.interactionsEngine.on("down",this.handleMouseDown.bind(this)),this.interactionsEngine.on("up",this.handleMouseUp.bind(this)),this.interactionsEngine.on("move",this.handleMouseMove.bind(this)),this.interactionsEngine.on("hover",this.handleHover.bind(this)),this.setSettings()}handleHover(e){this.hoveredRegion=e}handleMouseDown(e,t){e&&(e.type==="timeframeKnob"?(e.data==="left"?this.leftKnobMoving=!0:this.rightKnobMoving=!0,this.interactionsEngine.setCursor("ew-resize")):e.type==="timeframeArea"&&(this.selectingActive=!0,this.startSelectingPosition=t.x))}handleMouseUp(e,t,i){let s=!1;if(this.timeout&&(s=!0),clearTimeout(this.timeout),this.timeout=window.setTimeout(()=>this.timeout=void 0,300),this.leftKnobMoving=!1,this.rightKnobMoving=!1,this.interactionsEngine.clearCursor(),this.selectingActive&&!i&&this.applyChanges(),this.selectingActive=!1,i&&!s){const r=this.getRightKnobPosition(),o=this.getLeftKnobPosition();t.x>r?this.setRightKnobPosition(t.x):t.x>o&&t.x<r?t.x-o>r-t.x?this.setRightKnobPosition(t.x):this.setLeftKnobPosition(t.x):this.setLeftKnobPosition(t.x),this.applyChanges()}s&&(this.renderEngine.parent.setZoom(this.renderEngine.getInitialZoom()),this.renderEngine.parent.setPositionX(this.renderEngine.min),this.renderEngine.parent.render())}handleMouseMove(e,t){this.leftKnobMoving&&(this.setLeftKnobPosition(t.x),this.applyChanges()),this.rightKnobMoving&&(this.setRightKnobPosition(t.x),this.applyChanges()),this.selectingActive&&(this.startSelectingPosition>=t.x?(this.setLeftKnobPosition(t.x),this.setRightKnobPosition(this.startSelectingPosition)):(this.setRightKnobPosition(t.x),this.setLeftKnobPosition(this.startSelectingPosition)),this.renderEngine.render())}postInit(){this.offscreenRenderEngine=this.renderEngine.makeChild(),this.offscreenRenderEngine.setSettingsOverrides({styles:this.styles}),this.timeGrid=new pt({styles:this.renderEngine.parent.timeGrid.styles}),this.timeGrid.setDefaultRenderEngine(this.offscreenRenderEngine),this.offscreenRenderEngine.on("resize",()=>{this.offscreenRenderEngine.setZoom(this.renderEngine.getInitialZoom()),this.offscreenRender()}),this.offscreenRenderEngine.on("min-max-change",()=>this.shouldRender=!0),this.setData({flameChartNodes:this.flameChartNodes,waterfall:this.waterfall,timeseries:this.timeseries})}setLeftKnobPosition(e){const t=this.getRightKnobPosition();if(e<t-1){const i=this.renderEngine.getRealView(),s=this.renderEngine.setPositionX(this.offscreenRenderEngine.pixelToTime(e)+this.renderEngine.min),r=this.renderEngine.width/(i-s);this.renderEngine.setZoom(r)}}setRightKnobPosition(e){const t=this.getLeftKnobPosition();if(e>t+1){const i=this.renderEngine.getRealView(),s=this.renderEngine.positionX+i-(this.offscreenRenderEngine.pixelToTime(e)+this.renderEngine.min),r=this.renderEngine.width/(i-s);this.renderEngine.setZoom(r)}}getLeftKnobPosition(){return(this.renderEngine.positionX-this.renderEngine.min)*this.renderEngine.getInitialZoom()}getRightKnobPosition(){return(this.renderEngine.positionX-this.renderEngine.min+this.renderEngine.getRealView())*this.renderEngine.getInitialZoom()}applyChanges(){this.renderEngine.parent.setPositionX(this.renderEngine.positionX),this.renderEngine.parent.setZoom(this.renderEngine.zoom),this.renderEngine.parent.render()}setSettings({styles:e}={styles:this.styles}){this.styles=D(Oe,e),this.height=this.styles.height,this.offscreenRenderEngine&&(this.offscreenRenderEngine.setSettingsOverrides({styles:this.styles}),this.timeGrid.setSettings({styles:this.renderEngine.parent.timeGrid.styles})),this.shouldRender=!0}makeFlameChartDots(){if(this.flameChartNodes){const e=[],t=dt(this.flameChartNodes),{min:i,max:s}=ut(t);this.min=i,this.max=s,this.clusters=gt(t,()=>!0),this.actualClusters=Se(this.clusters,this.renderEngine.zoom,this.min,this.max,$e,1/0),this.actualClusterizedFlatTree=ft(this.actualClusters,this.renderEngine.zoom,this.min,this.max,$e,1/0).sort((a,l)=>a.start-l.start),this.actualClusterizedFlatTree.forEach(({start:a,end:l})=>{e.push({time:a,type:"start"},{time:l,type:"end"})}),e.sort((a,l)=>a.time-l.time);const{dots:r,maxLevel:o}=this.makeRenderDots(e);this.flameChartDots=r,this.flameChartMaxLevel=o}}makeRenderDots(e){const t=[];let i=0,s=0;return e.forEach(({type:r,time:o})=>{(r==="start"||r==="end")&&t.push([o,i]),r==="start"?i++:i--,s=Math.max(s,i),t.push([o,i])}),{dots:t,maxLevel:s}}makeWaterfallDots(){if(this.waterfall){const e=mt(this.waterfall),i=Object.entries(e.reduce((r,{intervals:o})=>(o.forEach(a=>{const{timeframeChart:l}=a;if(l){const h=typeof l=="string"?l:a.color;r[h]||(r[h]=[]),r[h].push(a)}}),r),{})).map(([r,o])=>{const a=[];return o.forEach(({start:l,end:h})=>{a.push({type:"start",time:l}),a.push({type:"end",time:h})}),a.sort((l,h)=>l.time-h.time),{color:r,points:a}});let s=0;this.waterfallDots=i.map(({color:r,points:o})=>{const{dots:a,maxLevel:l}=this.makeRenderDots(o);return s=Math.max(s,l),{color:r,dots:a}}),this.waterfallMaxLevel=s}}prepareTimeseries(){var e;!((e=this.timeseries)===null||e===void 0)&&e.length?this.preparedTimeseries=vt(this.timeseries):this.preparedTimeseries=void 0}setData({flameChartNodes:e,waterfall:t,timeseries:i}){this.flameChartNodes=e,this.waterfall=t,this.timeseries=i,this.makeFlameChartDots(),this.makeWaterfallDots(),this.prepareTimeseries(),this.offscreenRender()}setTimeseries(e){this.timeseries=e,this.prepareTimeseries(),this.offscreenRender()}setFlameChartNodes(e){this.flameChartNodes=e,this.makeFlameChartDots(),this.offscreenRender()}setWaterfall(e){this.waterfall=e,this.makeWaterfallDots(),this.offscreenRender()}offscreenRender(){const e=this.offscreenRenderEngine.getInitialZoom();if(this.offscreenRenderEngine.setZoom(e),this.offscreenRenderEngine.setPositionX(this.offscreenRenderEngine.min),this.offscreenRenderEngine.clear(),this.timeGrid.recalc(),this.timeGrid.renderLines(0,this.offscreenRenderEngine.height),this.timeGrid.renderTimes(),de({engine:this.offscreenRenderEngine,points:this.flameChartDots,min:0,max:this.flameChartMaxLevel,style:{lineColor:this.styles.graphStrokeColor,fillColor:this.styles.graphFillColor,type:this.styles.flameChartGraphType}}),this.waterfallDots.forEach(({color:t,dots:i})=>{const s=new pe(t);de({engine:this.offscreenRenderEngine,points:i,min:0,max:this.waterfallMaxLevel,style:{lineColor:s.alpha(this.styles.waterfallStrokeOpacity).rgb().toString(),fillColor:s.alpha(this.styles.waterfallFillOpacity).rgb().toString(),type:this.styles.waterfallGraphType}})}),this.preparedTimeseries){const{summary:t,timeseries:i}=this.preparedTimeseries;i.forEach(s=>{const r=yt(s.points,s,t);de({engine:this.offscreenRenderEngine,points:s.points,min:r.min,max:r.max,style:s.style})})}this.offscreenRenderEngine.setCtxValue("fillStyle",this.styles.bottomLineColor),this.offscreenRenderEngine.ctx.fillRect(0,this.height-1,this.offscreenRenderEngine.width,1)}renderTimeframe(){const e=this.renderEngine.positionX-this.renderEngine.min,t=e*this.renderEngine.getInitialZoom(),i=(e+this.renderEngine.getRealView())*this.renderEngine.getInitialZoom(),s=t-this.styles.knobSize/2,r=i-this.styles.knobSize/2,o=this.renderEngine.height/3;this.renderEngine.setCtxValue("fillStyle",this.styles.overlayColor),this.renderEngine.fillRect(0,0,t,this.renderEngine.height),this.renderEngine.fillRect(i,0,this.renderEngine.width-i,this.renderEngine.height),this.renderEngine.setCtxValue("fillStyle",this.styles.overlayColor),this.renderEngine.fillRect(t-1,0,1,this.renderEngine.height),this.renderEngine.fillRect(i+1,0,1,this.renderEngine.height),this.renderEngine.setCtxValue("fillStyle",this.styles.knobColor),this.renderEngine.fillRect(s,0,this.styles.knobSize,o),this.renderEngine.fillRect(r,0,this.styles.knobSize,o),this.renderEngine.renderStroke(this.styles.knobStrokeColor,s,0,this.styles.knobSize,o),this.renderEngine.renderStroke(this.styles.knobStrokeColor,r,0,this.styles.knobSize,o),this.interactionsEngine.addHitRegion("timeframeKnob","left",s,0,this.styles.knobSize,o,"ew-resize"),this.interactionsEngine.addHitRegion("timeframeKnob","right",r,0,this.styles.knobSize,o,"ew-resize"),this.interactionsEngine.addHitRegion("timeframeArea",null,0,0,this.renderEngine.width,this.renderEngine.height,"text")}renderTooltip(){if(this.hoveredRegion){const t=this.interactionsEngine.getMouse().x/this.renderEngine.getInitialZoom()+this.renderEngine.min,i=`${t.toFixed(this.renderEngine.getAccuracy()+2)} ${this.renderEngine.timeUnits}`,s=this.preparedTimeseries?bt(t,this.preparedTimeseries):[];return this.renderEngine.renderTooltipFromData([{text:i},...s],this.interactionsEngine.getGlobalMouse()),!0}return!1}render(){return this.shouldRender&&(this.shouldRender=!1,this.offscreenRender()),this.renderEngine.copy(this.offscreenRenderEngine),this.renderTimeframe(),this.interactionsEngine.addHitRegion("timeframe",null,0,0,this.renderEngine.width,this.height),!0}}const Bi={height:56},We=2;class Yi extends Y{constructor({name:e="timeseriesPlugin",data:t,settings:i}){super(e),this.height=56,this.hoveredRegion=null,this.setSettings(i),this.setData(t)}init(e,t){super.init(e,t),this.interactionsEngine.on("change-position",this.handlePositionChange.bind(this)),this.interactionsEngine.on("hover",this.handleHover.bind(this)),this.interactionsEngine.on("up",this.handleMouseUp.bind(this))}handlePositionChange(e){const t=this.renderEngine.parent.positionX;this.interactionsEngine.setCursor("grabbing"),this.renderEngine.tryToChangePosition(e.deltaX),t!==this.renderEngine.parent.positionX&&this.renderEngine.parent.render()}handleMouseUp(){this.interactionsEngine.clearCursor()}setSettings({styles:e}={styles:this.styles}){this.styles=D(Bi,e),this.height=this.styles.height}setData(e){const t=vt(e);this.data=t,this.min=t.total.min,this.max=t.total.max,this.renderEngine&&(this.renderEngine.recalcMinMax(),this.renderEngine.resetParentView())}handleHover(e){this.hoveredRegion=e}renderTooltip(){if(this.hoveredRegion){const e=this.interactionsEngine.getMouse().x,t=this.renderEngine.pixelToTime(e)+this.renderEngine.positionX,i=`${t.toFixed(this.renderEngine.getAccuracy()+2)} ${this.renderEngine.timeUnits}`,s=bt(t,this.data);return this.renderEngine.renderTooltipFromData([{text:i},...s],this.interactionsEngine.getGlobalMouse()),!0}return!1}render(){if(this.data.timeseries.length===0)return;const e=this.renderEngine.positionX,t=this.renderEngine.positionX+this.renderEngine.getRealView();this.data.timeseries.forEach((i,s)=>{if(this.data.timeboxes[s].end<e||this.data.timeboxes[s].start>t)return;const r=e<=this.data.timeboxes[s].start?0:Math.max(i.points.findIndex(([h])=>h>=e)-We,0),o=t>=this.data.timeboxes[s].end?i.points.length:i.points.findIndex(([h])=>h>=t)+We,a=i.points.slice(r,o),l=yt(a,i,this.data.summary);de({engine:this.renderEngine,points:a,min:l.min,max:l.max,style:i.style})}),this.interactionsEngine.addHitRegion("timeseries",null,0,0,this.renderEngine.width,this.height)}}const be={defaultHeight:68,lineWidth:1,lineHeight:"inherit"};class Zi extends Y{constructor({data:e,name:t="waterfallPlugin",settings:i}){super(t),this.styles=be,this.height=be.defaultHeight,this.data=[],this.positionY=0,this.hoveredRegion=null,this.selectedRegion=null,this.initialData=[],this.setData(e),this.setSettings(i)}init(e,t){super.init(e,t),this.interactionsEngine.on("change-position",this.handlePositionChange.bind(this)),this.interactionsEngine.on("hover",this.handleHover.bind(this)),this.interactionsEngine.on("select",this.handleSelect.bind(this)),this.interactionsEngine.on("up",this.handleMouseUp.bind(this))}handlePositionChange({deltaX:e,deltaY:t}){const i=this.positionY,s=this.renderEngine.parent.positionX;this.interactionsEngine.setCursor("grabbing"),this.positionY+t>=0?this.setPositionY(this.positionY+t):this.setPositionY(0),this.renderEngine.tryToChangePosition(e),(s!==this.renderEngine.parent.positionX||i!==this.positionY)&&this.renderEngine.parent.render()}handleMouseUp(){this.interactionsEngine.clearCursor()}handleHover(e){this.hoveredRegion=e}handleSelect(e){var t;if(this.selectedRegion!==e){this.selectedRegion=e;const i=(t=e==null?void 0:e.data)!==null&&t!==void 0?t:null;this.emit("select",{node:i!==null?this.initialData[i]:null,type:"waterfall-node"}),this.renderEngine.render()}}setPositionY(e){this.positionY=e}setSettings({styles:e}){this.styles=D(be,e),this.height=this.styles.defaultHeight,this.positionY=0}setData(e){this.positionY=0,this.initialData=e.items,this.data=mt(e),e.items.length&&(this.min=this.data.reduce((t,{min:i})=>Math.min(t,i),this.data[0].min),this.max=this.data.reduce((t,{max:i})=>Math.max(t,i),this.data[0].max)),this.renderEngine&&(this.renderEngine.recalcMinMax(),this.renderEngine.resetParentView())}calcRect(e,t,i){const s=t*this.renderEngine.zoom;return{x:this.renderEngine.timeToPosition(e),w:i?s<=.1?.1:s>=3?s-1:s-s/3:s}}renderTooltip(){if(this.hoveredRegion){if(this.renderEngine.options.tooltip===!1)return!0;if(typeof this.renderEngine.options.tooltip=="function"){const{data:e}=this.hoveredRegion,t={...this.hoveredRegion};t.data=this.data.find(({index:i})=>e===i),this.renderEngine.options.tooltip(t,this.renderEngine,this.interactionsEngine.getGlobalMouse())}else{const{data:e}=this.hoveredRegion,t=this.data.find(({index:i})=>e===i);if(t){const{name:i,intervals:s,timing:r,meta:o=[]}=t,a=this.renderEngine.getTimeUnits(),l=this.renderEngine.getAccuracy()+2,h={text:`${i}`},c={text:"intervals",color:this.renderEngine.styles.tooltipHeaderFontColor},d=s.map(({name:v,start:m,end:y})=>({text:`${v}: ${(y-m).toFixed(l)} ${a}`})),u={text:"timing",color:this.renderEngine.styles.tooltipHeaderFontColor},p=Object.entries(r).filter(([,v])=>typeof v=="number").map(([v,m])=>({text:`${v}: ${m.toFixed(l)} ${a}`})),g={text:"meta",color:this.renderEngine.styles.tooltipHeaderFontColor},x=o?o.map(({name:v,value:m,color:y})=>({text:`${v}: ${m}`,color:y})):[];this.renderEngine.renderTooltipFromData([h,c,...d,u,...p,...x.length?[g,...x]:[]],this.interactionsEngine.getGlobalMouse())}}return!0}return!1}render(){const e=this.renderEngine.positionX+this.renderEngine.getRealView(),t=this.renderEngine.positionX,i=this.renderEngine.blockHeight+1,s=[];this.data.filter(({min:o,max:a})=>!(e<o&&e<a||t>a&&e>o)).map(o=>{for(;s.length&&o.min-W(s).max>0;)s.pop();const a=s.length,l={...o,level:a};return s.push(o),l}).forEach(({name:o,intervals:a,textBlock:l,level:h,index:c})=>{const d=h*i-this.positionY;if(d+i>=0&&d-i<=this.renderEngine.height){const u=this.renderEngine.timeToPosition(l.start),p=this.renderEngine.timeToPosition(l.end);this.renderEngine.addText({text:o,x:u,y:d,w:p-u});const{x:g,w:x}=a.reduce((v,{color:m,pattern:y,start:E,end:T,type:w},b)=>{const{x:z,w:A}=this.calcRect(E,T-E,b===a.length-1);if(w==="block")this.renderEngine.addRect({color:m,pattern:y,x:z,y:d,w:A});else if(w==="line"){const V=Math.min(this.styles.lineWidth,A);if(this.renderEngine.addRect({color:m,pattern:y,x:b===0?z+V:z,y:d+(i-this.styles.lineWidth)/2,w:b===a.length-1?A-V:A,h:this.styles.lineWidth}),b===0||b===a.length-1){const Fe=this.styles.lineHeight==="inherit"?i/2:this.styles.lineHeight;this.renderEngine.addRect({color:m,pattern:y,x:b===0?z:z+A-V,y:d+(i-Fe)/2,w:V,h:Fe})}}return{x:v.x===null?z:v.x,w:A+v.w}},{x:null,w:0});this.selectedRegion&&this.selectedRegion.type==="waterfall-node"&&this.selectedRegion.data===c&&this.renderEngine.addStroke({color:"green",x:g??0,y:d,w:x,h:this.renderEngine.blockHeight}),this.interactionsEngine.addHitRegion("waterfall-node",c,g??0,d,x,this.renderEngine.blockHeight)}},0)}}const Xe={height:16,color:"rgb(202,202,202, 0.25)",strokeColor:"rgb(138,138,138, 0.50)",dotsColor:"rgb(97,97,97)",fontColor:"black",font:"10px sans-serif",triangleWidth:10,triangleHeight:7,triangleColor:"black",leftPadding:10};class Ge extends Y{constructor(e,t){super("togglePlugin"),this.styles=Xe,this.height=0,this.resizeActive=!1,this.resizeStartHeight=0,this.resizeStartPosition=0,this.setSettings(t),this.title=e}setSettings({styles:e}={}){this.styles=D(Xe,e),this.height=this.styles.height+1}init(e,t){super.init(e,t),this.getNextEngine().setFlexible(),this.interactionsEngine.on("click",s=>{if(s&&s.type==="toggle"&&s.data===this.renderEngine.id){const r=this.getNextEngine();r.collapsed?r.expand():r.collapse(),this.renderEngine.parent.recalcChildrenLayout(),this.renderEngine.parent.render()}}),this.interactionsEngine.on("down",s=>{if(s&&s.type==="knob-resize"&&s.data===this.renderEngine.id){const r=this.getPrevEngine();this.interactionsEngine.setCursor("row-resize"),this.resizeActive=!0,this.resizeStartHeight=r.height,this.resizeStartPosition=this.interactionsEngine.getGlobalMouse().y}}),this.interactionsEngine.parent.on("move",()=>{if(this.resizeActive){const s=this.getPrevEngine(),r=this.interactionsEngine.getGlobalMouse();if(s.flexible){const o=this.resizeStartHeight-(this.resizeStartPosition-r.y);o<=0?(s.collapse(),s.resize({height:0})):(s.collapsed&&s.expand(),s.resize({height:o})),this.renderEngine.parent.render()}}}),this.interactionsEngine.parent.on("up",()=>{this.interactionsEngine.clearCursor(),this.resizeActive=!1})}getPrevEngine(){var e;const t=((e=this.renderEngine.id)!==null&&e!==void 0?e:0)-1;return this.renderEngine.parent.children[t]}getNextEngine(){var e;const t=((e=this.renderEngine.id)!==null&&e!==void 0?e:0)+1;return this.renderEngine.parent.children[t]}render(){const e=this.getNextEngine(),t=this.getPrevEngine(),i=this.styles.leftPadding+this.styles.triangleWidth,s=this.renderEngine.width/2,r=this.styles.height/2;this.renderEngine.setCtxFont(this.styles.font),this.renderEngine.setCtxValue("fillStyle",this.styles.color),this.renderEngine.setCtxValue("strokeStyle",this.styles.strokeColor),this.renderEngine.fillRect(0,0,this.renderEngine.width,this.styles.height),this.renderEngine.setCtxValue("fillStyle",this.styles.fontColor),this.renderEngine.addText({text:this.title,x:i,y:0,w:this.renderEngine.width}),e.collapsed?this.renderEngine.renderTriangle({color:this.styles.triangleColor,x:this.styles.leftPadding+this.styles.triangleHeight/2,y:(this.styles.height-this.styles.triangleWidth)/2,width:this.styles.triangleWidth,height:this.styles.triangleHeight,direction:"right"}):this.renderEngine.renderTriangle({color:this.styles.triangleColor,x:this.styles.leftPadding,y:(this.styles.height-this.styles.triangleHeight)/2,width:this.styles.triangleWidth,height:this.styles.triangleHeight,direction:"bottom"});const{width:o}=this.renderEngine.ctx.measureText(this.title),a=o+i;this.interactionsEngine.addHitRegion("toggle",this.renderEngine.id,0,0,a,this.styles.height,"pointer"),t.flexible&&(this.renderEngine.renderCircle(this.styles.dotsColor,s,r,1.5),this.renderEngine.renderCircle(this.styles.dotsColor,s-10,r,1.5),this.renderEngine.renderCircle(this.styles.dotsColor,s+10,r,1.5),this.interactionsEngine.addHitRegion("knob-resize",this.renderEngine.id,a,0,this.renderEngine.width-a,this.styles.height,"row-resize"))}}const ae=()=>{const n=document.createElement("canvas");return{ctx:n.getContext("2d"),canvas:n}},xt=({color:n="black",background:e="rgb(255,255,255, 0)",lineWidth:t=6,spacing:i=4,angle:s=45,dash:r}={})=>o=>{const{ctx:a,canvas:l}=ae(),h=4;a.setTransform(h,0,0,h,0,0),l.height=o.blockHeight*h;const c=t*h,d=i*h+c,u=s*Math.PI/180,p=u>Math.PI*3/2&&u<Math.PI*2||u>Math.PI/2&&u<Math.PI,g=u===Math.PI||u===Math.PI*2,x=u===Math.PI/2||u===Math.PI*3/2,v=g||x?g?c:c+d/2:Math.abs(Math.ceil(d/Math.cos(Math.PI/2-u)));l.width=v,a.fillStyle=e,a.fillRect(0,0,l.width,l.height),a.strokeStyle=n,a.lineWidth=c,a.lineCap="square";let m=0;if(a.beginPath(),r&&a.setLineDash(r.map(E=>E*h)),g)for(m=c/2;m<=l.height;)a.moveTo(0,m),a.lineTo(v,m),m+=d;else if(x)a.moveTo(v/2,0),a.lineTo(v/2,l.height);else{const E=Math.abs(d/Math.cos(u)),T=Math.abs(Math.ceil(Math.sin(u)*c));if(p)for(m=l.height;m>=0-c;)a.moveTo(0,m+T),m-=E,a.lineTo(v,m+T);else for(;m<=l.height+c;)a.moveTo(0,m-T),m+=E,a.lineTo(v,m-T)}return a.stroke(),{pattern:o.ctx.createPattern(l,"repeat"),width:v,scale:h}},Et=({color:n="black",background:e="rgb(255,255,255, 0)",size:t=2,rows:i,align:s="center",spacing:r=2,verticalSpicing:o=r,horizontalSpicing:a=r}={})=>l=>{const{ctx:h,canvas:c}=ae(),d=4,u=t*d,p=u/2,g=o*d,x=a*d,v=(t+x/4)*d,m=l.blockHeight*d,y=i||Math.floor(m/(u+g));h.setTransform(d,0,0,d,0,0),c.height=m,c.width=v,h.fillStyle=e,h.fillRect(0,0,c.width,c.height),h.fillStyle=n;const E=m-((u+g)*y-g),T=s==="center"?E/2:s==="top"?0:E;for(let b=0;b<y;b++)h.arc(v/2,T+(u+g)*b+p,p,0,2*Math.PI),h.fill();return{pattern:l.ctx.createPattern(c,"repeat"),width:v,scale:d}},wt=({colors:n})=>e=>{const{ctx:t,canvas:i}=ae(),s=4,r=s,o=e.blockHeight*s;t.setTransform(s,0,0,s,0,0),i.height=o,i.width=r;const a=t.createLinearGradient(0,0,r,o);for(const{offset:h,color:c}of n)a.addColorStop(h,c);return t.fillStyle=a,t.fillRect(0,0,r,o),{pattern:e.ctx.createPattern(i,"repeat"),width:r,scale:s}},kt=({color:n="black",background:e="rgb(255,255,255, 0)",width:t=16,height:i=t/2,align:s="center",direction:r="right",spacing:o=t})=>a=>{const{ctx:l,canvas:h}=ae(),c=4,d=at(t*c,i*c,r),u=Math.max(...d.map(({x:y})=>y)),p=Math.max(...d.map(({y})=>y)),g=u+o*c,x=a.blockHeight*c,v=s==="center"?(x-p)/2:s==="top"?0:x-p;return l.setTransform(c,0,0,c,0,0),h.height=x,h.width=g,l.fillStyle=e,l.fillRect(0,0,h.width,h.height),l.fillStyle=n,l.beginPath(),l.moveTo(d[0].x,d[0].y+v),d.slice(1).forEach(({x:y,y:E})=>l.lineTo(y,E+v)),l.closePath(),l.fill(),{pattern:a.ctx.createPattern(h,"repeat"),width:g,scale:c}},ji={stripes:xt,dots:Et,gradient:wt,triangles:kt};function Qi(n,e=1/0){const t=Math.max(...n);if(n.every(s=>t%s===0))return t;let i=1;for(;i<e;){let s=!0;for(let r=0;r<n.length;r++)if(i%n[r]!==0){s=!1;break}if(s)return i;i++}return e}const Ji=n=>e=>{const{ctx:t,canvas:i}=ae(),s=4,r=n.map(c=>"creator"in c?c.creator(e):ji[c.type](c.config)(e)),o=e.blockHeight*s,a=Qi(r.map(({width:c=1,scale:d=1})=>c*(s/d)),e.width*s),l=Math.max(...r.map(c=>c.scale||1));return t.setTransform(l,0,0,l,0,0),i.height=o,i.width=a,r.forEach(({scale:c=1,pattern:d})=>{t.fillStyle=d,d.setTransform(new DOMMatrixReadOnly().scale(s/c,s/c)),t.fillRect(0,0,a,o)}),{pattern:e.ctx.createPattern(i,"repeat"),width:a,scale:s}},en={stripes:xt,dots:Et,gradient:wt,triangles:kt,combined:Ji},Ue=`QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm1234567890_-+()[]{}\\/|'";:.,?~`,tn=()=>{const n=navigator.userAgent.toLowerCase();return n.includes("safari")?!n.includes("chrome"):!1};function nn(n){const e=n,t=window.devicePixelRatio||1,i=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return t/i}const Ve={tooltip:void 0,timeUnits:"ms"},Ne={blockHeight:16,blockPaddingLeftRight:4,backgroundColor:"white",font:"10px sans-serif",fontColor:"black",badgeSize:8,tooltipHeaderFontColor:"black",tooltipBodyFontColor:"#688f45",tooltipBackgroundColor:"white",tooltipShadowColor:"black",tooltipShadowBlur:6,tooltipShadowOffsetX:0,tooltipShadowOffsetY:0,headerHeight:14,headerColor:"rgba(112, 112, 112, 0.25)",headerStrokeColor:"rgba(112, 112, 112, 0.5)",headerTitleLeftPadding:16};class Ct extends re.EventEmitter{constructor(e,t){super(),this.options=Ve,this.timeUnits="ms",this.styles=Ne,this.blockPaddingLeftRight=0,this.blockHeight=0,this.blockPaddingTopBottom=0,this.charHeight=0,this.placeholderWidth=0,this.avgCharWidth=0,this.minTextWidth=0,this.queue={},this.zoom=0,this.positionX=0,this.min=0,this.max=0,this.patterns={},this.ctxCachedSettings={},this.ctxCachedCalls={},this.setCtxValue=(i,s)=>{this.ctxCachedSettings[i]!==s&&(this.ctx[i]=s,this.ctxCachedSettings[i]=s)},this.callCtx=(i,s)=>{(!this.ctxCachedCalls[i]||this.ctxCachedCalls[i]!==s)&&(this.ctx[i](s),this.ctxCachedCalls[i]=s)},this.width=e.width,this.height=e.height,this.isSafari=tn(),this.canvas=e,this.ctx=e.getContext("2d",{alpha:!1}),this.pixelRatio=nn(this.ctx),this.setSettings(t),this.applyCanvasSize(),this.reset()}setSettings({options:e,styles:t,patterns:i}){if(this.options=D(Ve,e),this.styles=D(Ne,t),i){const h=i.filter(d=>"creator"in d);i.filter(d=>!("creator"in d)).forEach(d=>this.createDefaultPattern(d)),h.forEach(d=>this.createBlockPattern(d))}this.timeUnits=this.options.timeUnits,this.blockHeight=this.styles.blockHeight,this.ctx.font=this.styles.font;const{actualBoundingBoxAscent:s,actualBoundingBoxDescent:r,width:o}=this.ctx.measureText(Ue),{width:a}=this.ctx.measureText(""),l=s+r;this.blockPaddingLeftRight=this.styles.blockPaddingLeftRight,this.blockPaddingTopBottom=Math.ceil((this.blockHeight-l)/2),this.charHeight=l+1,this.placeholderWidth=a,this.avgCharWidth=o/Ue.length,this.minTextWidth=this.avgCharWidth+this.placeholderWidth}reset(){this.queue={},this.ctxCachedCalls={},this.ctxCachedSettings={}}setCtxShadow(e){var t,i;this.setCtxValue("shadowBlur",e.blur),this.setCtxValue("shadowColor",e.color),this.setCtxValue("shadowOffsetY",(t=e.offsetY)!==null&&t!==void 0?t:0),this.setCtxValue("shadowOffsetX",(i=e.offsetX)!==null&&i!==void 0?i:0)}setCtxFont(e){e&&this.ctx.font!==e&&(this.ctx.font=e)}fillRect(e,t,i,s){this.ctx.fillRect(e,t,i,s)}fillText(e,t,i){this.ctx.fillText(e,t,i)}renderBlock(e,t,i,s){const r=Math.min(this.width,Math.max(0,e)),o=r-e,a=Math.min(this.width-r,Math.max(0,i-o));this.ctx.fillRect(r,t,a,s??this.blockHeight)}renderStroke(e,t,i,s,r){this.setCtxValue("strokeStyle",e),this.ctx.setLineDash([]),this.ctx.strokeRect(t,i,s,r)}clear(e=this.width,t=this.height,i=0,s=0){this.setCtxValue("fillStyle",this.styles.backgroundColor),this.ctx.clearRect(i,s,e,t-1),this.ctx.fillRect(i,s,e,t),this.ctxCachedCalls={},this.ctxCachedSettings={},this.emit("clear")}timeToPosition(e){return e*this.zoom-this.positionX*this.zoom}pixelToTime(e){return e/this.zoom}setZoom(e){this.zoom=e}setPositionX(e){const t=this.positionX;return this.positionX=e,e-t}getQueue(e=0){return this.queue[e]||(this.queue[e]={text:[],stroke:[],rect:{}}),this.queue[e]}addRect(e,t=0){const i=this.getQueue(t);e.pattern=e.pattern||"none",i.rect[e.pattern]||(i.rect[e.pattern]={}),i.rect[e.pattern][e.color]||(i.rect[e.pattern][e.color]=[]),i.rect[e.pattern][e.color].push(e)}addText({text:e,x:t,y:i,w:s},r=0){if(e){const o=s-(this.blockPaddingLeftRight*2-(t<0?t:0));o>0&&this.getQueue(r).text.push({text:e,x:t,y:i,w:s,textMaxWidth:o})}}addStroke(e,t=0){this.getQueue(t).stroke.push(e)}resolveQueue(){Object.keys(this.queue).map(e=>parseInt(e)).sort().forEach(e=>{const{rect:t,text:i,stroke:s}=this.queue[e];this.renderRects(t),this.renderTexts(i),this.renderStrokes(s)}),this.queue={}}renderRects(e){Object.entries(e).forEach(([t,i])=>{let s=new DOMMatrixReadOnly,r;t!=="none"&&this.patterns[t]&&(r=this.patterns[t],r.scale!==1&&(s=s.scale(1/r.scale,1/r.scale)),this.ctx.fillStyle=r.pattern,this.ctxCachedSettings.fillStyle=t),Object.entries(i).forEach(([o,a])=>{r||this.setCtxValue("fillStyle",o),a.forEach(l=>{if(r){const h=l.x*r.scale,c=h-Math.floor(h/r.width)*r.width;r.pattern.setTransform(s.translate(c,l.y*r.scale))}this.renderBlock(l.x,l.y,l.w,l.h)})})})}renderTexts(e){this.setCtxValue("fillStyle",this.styles.fontColor),e.forEach(({text:t,x:i,y:s,textMaxWidth:r})=>{const{width:o}=this.ctx.measureText(t);if(o>r){const a=o/t.length,h=(Math.floor((r-this.placeholderWidth)/a)-1)/2;h>0?t=t.slice(0,Math.ceil(h))+""+t.slice(t.length-Math.floor(h),t.length):t=""}t&&this.ctx.fillText(t,(i<0?0:i)+this.blockPaddingLeftRight,s+this.blockHeight-this.blockPaddingTopBottom)})}renderStrokes(e){e.forEach(({color:t,x:i,y:s,w:r,h:o})=>{this.renderStroke(t,i,s,r,o)})}setMinMax(e,t){const i=e!==this.min||t!==this.max;this.min=e,this.max=t,i&&this.emit("min-max-change",e,t)}getTimeUnits(){return this.timeUnits}tryToChangePosition(e){const t=this.getRealView();this.positionX+e+t<=this.max&&this.positionX+e>=this.min?this.setPositionX(this.positionX+e):this.positionX+e<=this.min?this.setPositionX(this.min):this.positionX+e+t>=this.max&&this.setPositionX(this.max-t)}getInitialZoom(){return this.max-this.min>0?this.width/(this.max-this.min):1}getRealView(){return this.width/this.zoom}resetView(){this.setZoom(this.getInitialZoom()),this.setPositionX(this.min)}resize(e,t){const i=Math.max(0,e||0),s=Math.max(0,t||0),r=typeof e=="number"&&this.width!==i,o=typeof t=="number"&&this.height!==s;return r||o?(this.width=r?i:this.width,this.height=o?s:this.height,this.applyCanvasSize(),this.emit("resize",{width:this.width,height:this.height}),o):!1}applyCanvasSize(){this.canvas.style.backgroundColor="white",this.canvas.style.overflow="hidden",this.canvas.style.width=this.width+"px",this.canvas.style.height=this.height+"px",this.canvas.width=this.width*this.pixelRatio,this.canvas.height=this.height*this.pixelRatio,this.ctx.setTransform(this.pixelRatio,0,0,this.pixelRatio,0,0),this.ctx.font=this.styles.font}copy(e){const t=this.isSafari?1:e.pixelRatio;e.canvas.height&&this.ctx.drawImage(e.canvas,0,0,e.canvas.width*t,e.canvas.height*t,0,e.position||0,e.width*t,e.height*t)}createDefaultPattern({name:e,type:t,config:i}){const s=en[t];s&&this.createBlockPattern({name:e,creator:s(i)})}createCachedDefaultPattern(e){this.patterns[e.name]||this.createDefaultPattern(e)}createBlockPattern({name:e,creator:t}){this.patterns[e]={scale:1,width:10,...t(this)}}renderTooltipFromData(e,t){const i=t.x+10,s=t.y+10,o=e.map(({text:a})=>a).map(a=>this.ctx.measureText(a)).reduce((a,{width:l})=>Math.max(a,l),0)+this.blockPaddingLeftRight*2;this.setCtxShadow({color:this.styles.tooltipShadowColor,blur:this.styles.tooltipShadowBlur,offsetX:this.styles.tooltipShadowOffsetX,offsetY:this.styles.tooltipShadowOffsetY}),this.setCtxValue("fillStyle",this.styles.tooltipBackgroundColor),this.ctx.fillRect(i,s,o+this.blockPaddingLeftRight*2,(this.charHeight+2)*e.length+this.blockPaddingLeftRight*2),this.setCtxShadow({color:"transparent",blur:0}),e.forEach(({text:a,color:l},h)=>{l?this.setCtxValue("fillStyle",l):h?this.setCtxValue("fillStyle",this.styles.tooltipBodyFontColor):this.setCtxValue("fillStyle",this.styles.tooltipHeaderFontColor),this.ctx.fillText(a,i+this.blockPaddingLeftRight,s+this.blockHeight-this.blockPaddingTopBottom+(this.charHeight+2)*h)})}renderShape(e,t,i,s){this.setCtxValue("fillStyle",e),this.ctx.beginPath(),this.ctx.moveTo(t[0].x+i,t[0].y+s),t.slice(1).forEach(({x:r,y:o})=>this.ctx.lineTo(r+i,o+s)),this.ctx.closePath(),this.ctx.fill()}renderTriangle({color:e,x:t,y:i,width:s,height:r,direction:o}){this.renderShape(e,at(s,r,o),t,i)}renderCircle(e,t,i,s){this.ctx.beginPath(),this.ctx.arc(t,i,s,0,2*Math.PI,!1),this.setCtxValue("fillStyle",e),this.ctx.fill()}}class _e extends Ct{constructor({width:e,height:t,parent:i,id:s}){const r=document.createElement("canvas");r.width=e,r.height=t,super(r,{options:i.options,styles:i.styles}),this.flexible=!1,this.collapsed=!1,this.position=0,this.savedHeight=null,this.width=e,this.height=t,this.parent=i,this.id=s,this.children=[],this.applyCanvasSize()}makeChild(){const e=new _e({width:this.width,height:this.height,parent:this.parent,id:void 0});return this.children.push(e),e.setMinMax(this.min,this.max),e.resetView(),e}setFlexible(){this.flexible=!0}collapse(){this.collapsed=!0,this.savedHeight=this.height,this.clear()}expand(){this.collapsed=!1,this.savedHeight&&this.resize({height:this.savedHeight})}setSettingsOverrides(e){this.setSettings({styles:D(this.styles,e.styles),options:D(this.options,e.options)}),this.children.forEach(t=>t.setSettingsOverrides(e))}resize({width:e,height:t,position:i},s){const r=super.resize(e,t);(t??0)<=0&&(this.collapsed=!0),!s&&r&&this.parent.recalcChildrenLayout(),typeof i=="number"&&(this.position=i),this.children.forEach(o=>o.resize({width:e,height:t,position:i}))}setMinMax(e,t){super.setMinMax(e,t),this.children.forEach(i=>i.setMinMax(e,t))}setSettings(e){super.setSettings(e),this.children&&this.children.forEach(t=>t.setSettings(e))}tryToChangePosition(e){this.parent.tryToChangePosition(e)}recalcMinMax(){this.parent.calcMinMax()}getTimeUnits(){return this.parent.getTimeUnits()}getAccuracy(){return this.parent.timeGrid.accuracy}renderTimeGrid(){this.parent.timeGrid.renderLines(0,this.height,this)}renderTimeGridTimes(){this.parent.timeGrid.renderTimes(this)}standardRender(){this.resolveQueue(),this.renderTimeGrid()}renderTooltipFromData(e,t){this.parent.renderTooltipFromData(e,t)}resetParentView(){this.parent.resetView(),this.parent.render()}render(){this.parent.partialRender(this.id)}}const sn=6;class rn extends Ct{constructor({canvas:e,settings:t,timeGrid:i,plugins:s}){super(e,t),this.freeSpace=0,this.lastPartialAnimationFrame=null,this.lastGlobalAnimationFrame=null,this.plugins=s,this.children=[],this.requestedRenders=[],this.timeGrid=i,this.timeGrid.setDefaultRenderEngine(this)}makeInstance(){const e=new _e({width:this.width,height:0,id:this.children.length,parent:this});return e.setMinMax(this.min,this.max),e.resetView(),this.children.push(e),e}calcMinMax(){const e=this.plugins.map(({min:r})=>r).filter(Le),t=e.length?e.reduce((r,o)=>Math.min(r,o)):0,i=this.plugins.map(({max:r})=>r).filter(Le),s=i.length?i.reduce((r,o)=>Math.max(r,o)):0;this.setMinMax(t,s)}calcTimeGrid(){this.timeGrid.recalc()}setMinMax(e,t){super.setMinMax(e,t),this.children.forEach(i=>i.setMinMax(e,t))}setSettings(e){super.setSettings(e),this.children&&(this.children.forEach(t=>t.setSettings(e)),this.recalcChildrenLayout())}resize(e,t){const i=this.width;return super.resize(e,t),this.recalcChildrenLayout(),this.getInitialZoom()>this.zoom?this.resetView():this.positionX>this.min&&this.tryToChangePosition(-this.pixelToTime((e-i)/2)),!0}recalcChildrenLayout(){const e=this.getChildrenLayout();e.freeSpace>0?this.expandGrowingChildrenLayout(e):e.freeSpace<0&&this.truncateChildrenLayout(e),this.freeSpace=e.freeSpace,this.children.forEach((t,i)=>{t.resize(e.placements[i],!0)})}getChildrenLayout(){return this.children.reduce((e,t,i)=>{var s;const r=this.plugins[i],o=r.fullHeight;let a="static",l=0;if(t.flexible&&typeof r.height=="number"?a="flexibleStatic":r.height==="flexible"&&(a="flexibleGrowing"),t.collapsed)l=0;else switch(a){case"static":l=o;break;case"flexibleGrowing":l=t.height||0;break;case"flexibleStatic":l=(s=t.height||o)!==null&&s!==void 0?s:0;break}return e.placements.push({width:this.width,position:e.position,height:l,type:a}),e.position+=l,e.freeSpace-=l,e},{position:0,placements:[],freeSpace:this.height})}expandGrowingChildrenLayout(e){const{placements:t,freeSpace:i}=e,s=t[t.length-1],r=t.map(({type:a,height:l},h)=>a==="flexibleGrowing"&&!this.children[h].collapsed&&l===0),o=r.filter(Boolean).length;if(o){const a=Math.max(0,Math.floor(i/o));r.forEach((l,h)=>{if(l){t[h].height+=a,e.freeSpace-=a;for(let c=h+1;c<t.length;c++)t[c].position+=a}})}return s.type==="flexibleGrowing"&&!this.children[this.children.length-1].collapsed&&(s.height=Math.max(0,this.height-s.position),e.freeSpace=0),e}truncateChildrenLayout(e){const{placements:t,freeSpace:i}=e;let s=Math.abs(i);for(;s>0;){const r=t.findLastIndex(({height:o,type:a})=>o>0&&a!=="static");if(r!==-1){const o=t[r],a=Math.max(0,o.height-s),l=o.height-a;o.height=a,s-=l,e.freeSpace+=l,t.forEach((h,c)=>{c>r&&(h.position-=l)})}}return e}getAccuracy(){return this.timeGrid.accuracy}setZoom(e){if(this.getAccuracy()<sn||e<=this.zoom){const t=Math.max(e,this.getInitialZoom());if(t!==this.zoom)return super.setZoom(t),this.children.forEach(i=>i.setZoom(t)),!0}return!1}setPositionX(e){const t=super.setPositionX(e);return this.children.forEach(i=>i.setPositionX(e)),t}renderPlugin(e){var t;const i=this.plugins[e],s=this.children[e];s==null||s.clear(),s.collapsed||!((t=i==null?void 0:i.render)===null||t===void 0)&&t.call(i)||s.standardRender()}partialRender(e){typeof e=="number"&&this.requestedRenders.push(e),this.lastPartialAnimationFrame||(this.lastPartialAnimationFrame=requestAnimationFrame(()=>{this.requestedRenders.forEach(t=>this.renderPlugin(t)),this.shallowRender(),this.requestedRenders=[],this.lastPartialAnimationFrame=null}))}shallowRender(){this.clear(),this.timeGrid.renderLines(this.height-this.freeSpace,this.freeSpace),this.children.forEach(t=>{t.collapsed||this.copy(t)});let e=!1;this.plugins.forEach(t=>{t.postRender&&t.postRender()}),this.plugins.forEach(t=>{t.renderTooltip&&(e=e||!!t.renderTooltip())}),!e&&typeof this.options.tooltip=="function"&&this.options.tooltip(null,this,null)}render(e){typeof this.lastPartialAnimationFrame=="number"&&cancelAnimationFrame(this.lastPartialAnimationFrame),this.requestedRenders=[],this.lastPartialAnimationFrame=null;const t=performance.now();this.lastGlobalAnimationFrame||(this.lastGlobalAnimationFrame=requestAnimationFrame(()=>{this.lastGlobalAnimationFrame=null,e==null||e(performance.now()-t),this.timeGrid.recalc(),this.children.forEach((i,s)=>this.renderPlugin(s)),this.shallowRender()}))}}const on=["down","up","move","click","select"];class se extends re.EventEmitter{static getId(){return se.count++}constructor(e,t){super(),this.id=se.getId(),this.parent=e,this.renderEngine=t,t.on("clear",()=>this.clearHitRegions()),on.forEach(i=>e.on(i,(s,r,o)=>{(!s||s.id===this.id)&&this.resend(i,s,r,o)})),["hover"].forEach(i=>e.on(i,(s,r)=>{(!s||s.id===this.id)&&this.emit(i,s,r)})),e.on("change-position",(i,s,r,o)=>{o===this&&this.emit("change-position",i,s,r)}),this.hitRegions=[]}resend(e,...t){this.renderEngine.position<=this.parent.mouse.y&&this.renderEngine.height+this.renderEngine.position>=this.parent.mouse.y&&this.emit(e,...t)}getMouse(){const{x:e,y:t}=this.parent.mouse;return{x:e,y:t-this.renderEngine.position}}getGlobalMouse(){return this.parent.mouse}clearHitRegions(){this.hitRegions=[]}addHitRegion(e,t,i,s,r,o,a){this.hitRegions.push({type:e,data:t,x:i,y:s,w:r,h:o,cursor:a,id:this.id})}setCursor(e){this.parent.setCursor(e)}clearCursor(){this.parent.clearCursor()}}se.count=0;const an={hotkeys:{scrollSpeed:.5,zoomSpeed:.001,fastMultiplayer:5,active:!1}};class ln extends re.EventEmitter{constructor(e,t,i){var s;super(),this.selectedRegion=null,this.hoveredRegion=null,this.moveActive=!1,this.currentCursor=null,this.keys={},this.hotkeysActive=!1,this.renderEngine=t,this.canvas=e,this.settings={hotkeys:D(an.hotkeys,i==null?void 0:i.hotkeys)},this.hotkeysActive=!!(!((s=i==null?void 0:i.hotkeys)===null||s===void 0)&&s.active),this.hitRegions=[],this.instances=[],this.mouse={x:0,y:0},this.handleMouseWheel=this.handleMouseWheel.bind(this),this.handleMouseDown=this.handleMouseDown.bind(this),this.handleMouseUp=this.handleMouseUp.bind(this),this.handleMouseMove=this.handleMouseMove.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleKeyUp=this.handleKeyUp.bind(this),this.initListeners(),this.reset()}makeInstance(e){const t=new se(this,e);return this.instances.push(t),t}reset(){this.selectedRegion=null,this.hoveredRegion=null,this.hitRegions=[]}destroy(){this.removeListeners()}initListeners(){this.canvas&&(this.canvas.addEventListener("wheel",this.handleMouseWheel),this.canvas.addEventListener("mousedown",this.handleMouseDown),this.canvas.addEventListener("mouseup",this.handleMouseUp),this.canvas.addEventListener("mouseleave",this.handleMouseUp),this.canvas.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp))}removeListeners(){this.canvas&&(this.canvas.removeEventListener("wheel",this.handleMouseWheel),this.canvas.removeEventListener("mousedown",this.handleMouseDown),this.canvas.removeEventListener("mouseup",this.handleMouseUp),this.canvas.removeEventListener("mouseleave",this.handleMouseUp),this.canvas.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp))}hotkeys(e){this.hotkeysActive=e}handleKeyDown(e){!this.keys[e.key]&&this.hotkeysActive&&(this.keys[e.key]=!0,this.continueHandleKeys())}handleKeyUp(e){this.hotkeysActive&&(this.keys[e.key]=!1)}continueHandleKeys(){this.renderEngine.render(e=>this.handleKeys(e))}key(e){return!!this.keys[e]}getSpeed(){const{fastMultiplayer:e}=this.settings.hotkeys;return this.key("Shift")?e:1}handleKeys(e){const t=this.getSpeed();if(this.key("ArrowRight")||this.key("ArrowLeft")){const i=this.key("ArrowRight"),{scrollSpeed:s}=this.settings.hotkeys,r=(i?1:-1)*s*t*e/this.renderEngine.zoom;this.renderEngine.tryToChangePosition(r),this.continueHandleKeys()}if(this.key("=")||this.key("ArrowUp")||this.key("-")||this.key("ArrowDown")){const i=this.key("=")||this.key("ArrowUp"),{zoomSpeed:s}=this.settings.hotkeys,r=(i?-1:1)*s*t*e*this.renderEngine.zoom;this.changeZoom(r,this.renderEngine.width/2),this.continueHandleKeys()}}handleMouseWheel(e){const{deltaY:t,deltaX:i}=e;e.preventDefault();const s=this.renderEngine.positionX,r=this.renderEngine.zoom,o=i/this.renderEngine.zoom;this.renderEngine.tryToChangePosition(o);const a=this.getSpeed();this.changeZoom(t/1e3*a*this.renderEngine.zoom,this.mouse.x),this.checkRegionHover(),(s!==this.renderEngine.positionX||r!==this.renderEngine.zoom)&&this.renderEngine.render()}changeZoom(e,t=this.renderEngine.width/2){const i=this.renderEngine.getRealView();this.renderEngine.setZoom(this.renderEngine.zoom-e)&&this.fixPositionAfterZoom(i,t)}fixPositionAfterZoom(e,t){const i=t/this.renderEngine.width,r=(e-this.renderEngine.width/this.renderEngine.zoom)*i;this.renderEngine.tryToChangePosition(r)}handleMouseDown(){this.moveActive=!0,this.mouseDownPosition={x:this.mouse.x,y:this.mouse.y},this.mouseDownHoveredInstance=this.hoveredInstance,this.emit("down",this.hoveredRegion,this.mouse)}handleMouseUp(){this.moveActive=!1;const e=this.mouseDownPosition&&this.mouseDownPosition.x===this.mouse.x&&this.mouseDownPosition.y===this.mouse.y;e&&this.handleRegionHit(),this.emit("up",this.hoveredRegion,this.mouse,e),e&&this.emit("click",this.hoveredRegion,this.mouse)}handleMouseMove(e){if(this.moveActive){const t=this.mouse.y-e.offsetY,i=(this.mouse.x-e.offsetX)/this.renderEngine.zoom;(t||i)&&this.emit("change-position",{deltaX:i,deltaY:t},this.mouseDownPosition,this.mouse,this.mouseDownHoveredInstance)}this.mouse.x=e.offsetX,this.mouse.y=e.offsetY,this.checkRegionHover(),this.emit("move",this.hoveredRegion,this.mouse)}handleRegionHit(){const e=this.getHoveredRegion();this.emit("select",e,this.mouse)}checkRegionHover(){const e=this.getHoveredRegion();e&&this.hoveredRegion&&e.id!==this.hoveredRegion.id&&this.emit("hover",null,this.mouse),e?(!this.currentCursor&&e.cursor?this.renderEngine.canvas.style.cursor=e.cursor:this.currentCursor||this.clearCursor(),this.hoveredRegion=e,this.emit("hover",e,this.mouse),this.renderEngine.partialRender()):this.hoveredRegion&&!e&&(this.currentCursor||this.clearCursor(),this.hoveredRegion=null,this.emit("hover",null,this.mouse),this.renderEngine.partialRender())}getHoveredRegion(){const e=this.hitRegions.find(({x:i,y:s,w:r,h:o})=>this.mouse.x>=i&&this.mouse.x<=i+r&&this.mouse.y>=s&&this.mouse.y<=s+o);if(e)return e;const t=this.instances.find(({renderEngine:i})=>i.position<=this.mouse.y&&i.height+i.position>=this.mouse.y);if(this.hoveredInstance=t,t){const i=t.renderEngine.position;return t.hitRegions.find(({x:s,y:r,w:o,h:a})=>this.mouse.x>=s&&this.mouse.x<=s+o&&this.mouse.y>=r+i&&this.mouse.y<=r+a+i)}return null}clearHitRegions(){this.hitRegions=[]}addHitRegion(e,t,i,s,r,o,a){this.hitRegions.push({type:e,data:t,x:i,y:s,w:r,h:o,cursor:a})}setCursor(e){this.renderEngine.canvas.style.cursor=e,this.currentCursor=e}clearCursor(){const e=this.getHoveredRegion();this.currentCursor=null,e!=null&&e.cursor?this.renderEngine.canvas.style.cursor=e.cursor:this.renderEngine.canvas.style.cursor=""}}class hn extends re.EventEmitter{constructor({canvas:e,plugins:t,settings:i}){var s;super();const r=(s=i==null?void 0:i.styles)!==null&&s!==void 0?s:{};this.timeGrid=new pt({styles:r==null?void 0:r.timeGrid}),this.renderEngine=new rn({canvas:e,settings:{styles:r==null?void 0:r.main,options:i==null?void 0:i.options},plugins:t,timeGrid:this.timeGrid}),this.interactionsEngine=new ln(e,this.renderEngine,i==null?void 0:i.options),this.plugins=t;const o=Array(this.plugins.length).fill(null).map(()=>{const a=this.renderEngine.makeInstance(),l=this.interactionsEngine.makeInstance(a);return{renderEngine:a,interactionsEngine:l}});this.plugins.forEach((a,l)=>{a.init(o[l].renderEngine,o[l].interactionsEngine)}),this.renderEngine.calcMinMax(),this.renderEngine.resetView(),this.renderEngine.recalcChildrenLayout(),this.renderEngine.calcTimeGrid(),this.plugins.forEach(a=>{var l;return(l=a.postInit)===null||l===void 0?void 0:l.call(a)}),this.renderEngine.render()}render(){this.renderEngine.render()}resize(e,t){this.renderEngine.render(()=>this.renderEngine.resize(e,t))}execOnPlugins(e,...t){let i=0;for(;i<this.plugins.length;)this.plugins[i][e]&&this.plugins[i][e](...t),i++}setSettings(e){var t,i;this.timeGrid.setSettings({styles:(t=e.styles)===null||t===void 0?void 0:t.timeGrid}),this.renderEngine.setSettings({options:e.options,styles:(i=e.styles)===null||i===void 0?void 0:i.main,patterns:e.patterns}),this.plugins.forEach(s=>{var r,o;return(r=s.setSettings)===null||r===void 0?void 0:r.call(s,{styles:(o=e.styles)===null||o===void 0?void 0:o[s.name]})}),this.renderEngine.render()}setZoom(e,t){const i=this.renderEngine.width/(t-e);this.renderEngine.setPositionX(e),this.renderEngine.setZoom(i),this.renderEngine.render()}hotkeys(e){this.interactionsEngine.hotkeys(e)}}const cn={};class dn extends hn{constructor({canvas:e,data:t,marks:i,waterfall:s,timeframeTimeseries:r,timeseries:o,colors:a,settings:l=cn,plugins:h=[]}){var c;const d=[],{headers:{waterfall:u="waterfall",flameChart:p="flame chart"}={}}=l,g=(c=l==null?void 0:l.styles)!==null&&c!==void 0?c:{},x=new Xi({styles:g==null?void 0:g.timeGridPlugin});d.push(x);let v,m,y,E,T;o&&(T=new Yi({data:o,settings:{styles:g==null?void 0:g.timeseriesPlugin}}),d.push(T)),i&&(v=new Gi({data:i}),v.on("select",w=>this.emit("select",w)),d.push(v)),s&&(m=new Zi({data:s,settings:{styles:g==null?void 0:g.waterfallPlugin}}),m.on("select",w=>this.emit("select",w)),t&&d.push(new Ge(u,{styles:g==null?void 0:g.togglePlugin})),d.push(m)),t&&(E=new Wi({data:t,colors:a}),E.on("select",w=>this.emit("select",w)),s&&d.push(new Ge(p,{styles:g==null?void 0:g.togglePlugin})),d.push(E)),(t||s||r)&&(y=new qi({flameChartNodes:t,waterfall:s,timeseries:r,settings:{styles:g==null?void 0:g.timeframeSelectorPlugin}}),d.unshift(y)),super({canvas:e,settings:l,plugins:[...d,...h]}),E&&y&&(this.setNodes=w=>{E&&E.setData(w),y&&y.setFlameChartNodes(w)},this.setFlameChartPosition=({x:w,y:b})=>{typeof w=="number"&&this.renderEngine.setPositionX(w),typeof b=="number"&&E&&E.setPositionY(b),this.renderEngine.render()}),v&&(this.setMarks=w=>{v&&v.setMarks(w)}),m&&(this.setWaterfall=w=>{m&&m.setData(w),y&&y.setWaterfall(w)}),T&&(this.setTimeseries=w=>{T&&T.setData(w)}),y&&(this.setTimeframeTimeseries=w=>{y==null||y.setTimeseries(w)})}}var un="Expected a function",Ke=NaN,gn="[object Symbol]",fn=/^\s+|\s+$/g,pn=/^[-+]0x[0-9a-f]+$/i,mn=/^0b[01]+$/i,vn=/^0o[0-7]+$/i,yn=parseInt,bn=typeof le=="object"&&le&&le.Object===Object&&le,xn=typeof self=="object"&&self&&self.Object===Object&&self,En=bn||xn||Function("return this")(),wn=Object.prototype,kn=wn.toString,Cn=Math.max,Mn=Math.min,xe=function(){return En.Date.now()};function Rn(n,e,t){var i,s,r,o,a,l,h=0,c=!1,d=!1,u=!0;if(typeof n!="function")throw new TypeError(un);e=qe(e)||0,Me(t)&&(c=!!t.leading,d="maxWait"in t,r=d?Cn(qe(t.maxWait)||0,e):r,u="trailing"in t?!!t.trailing:u);function p(b){var z=i,A=s;return i=s=void 0,h=b,o=n.apply(A,z),o}function g(b){return h=b,a=setTimeout(m,e),c?p(b):o}function x(b){var z=b-l,A=b-h,V=e-z;return d?Mn(V,r-A):V}function v(b){var z=b-l,A=b-h;return l===void 0||z>=e||z<0||d&&A>=r}function m(){var b=xe();if(v(b))return y(b);a=setTimeout(m,x(b))}function y(b){return a=void 0,u&&i?p(b):(i=s=void 0,o)}function E(){a!==void 0&&clearTimeout(a),h=0,i=l=s=a=void 0}function T(){return a===void 0?o:y(xe())}function w(){var b=xe(),z=v(b);if(i=arguments,s=this,l=b,z){if(a===void 0)return g(l);if(d)return a=setTimeout(m,e),p(l)}return a===void 0&&(a=setTimeout(m,e)),o}return w.cancel=E,w.flush=T,w}function Me(n){var e=typeof n;return!!n&&(e=="object"||e=="function")}function Pn(n){return!!n&&typeof n=="object"}function Sn(n){return typeof n=="symbol"||Pn(n)&&kn.call(n)==gn}function qe(n){if(typeof n=="number")return n;if(Sn(n))return Ke;if(Me(n)){var e=typeof n.valueOf=="function"?n.valueOf():n;n=Me(e)?e+"":e}if(typeof n!="string")return n===0?n:+n;n=n.replace(fn,"");var t=mn.test(n);return t||vn.test(n)?yn(n.slice(2),t?2:8):pn.test(n)?Ke:+n}var _n=Rn;const Tn=Ye(_n),Fn={class:"graph-wrapper"},zn=G({__name:"flame-graph",props:{payload:{}},emits:["hover","hide"],setup(n,{emit:e}){const t=n,i=e,s=S(),r=S(),o=async()=>{if(!r.value||!s.value)return;const{width:a,height:l}=r.value.getBoundingClientRect();s.value.width=a||1,s.value.height=l||1;const h=new dn({canvas:s.value,data:await fetch(`${Re}/api/profiler/${t.payload.profile_uuid}/flame-chart`).then(c=>c.json()),settings:{styles:{main:{blockHeight:20}},options:{tooltip:(c,d,u)=>{c===null?i("hide"):i("hover",{callee:c.data.source.name,caller:"",cost:c.data.source.cost,position:{x:(u==null?void 0:u.x)+20||0,y:(u==null?void 0:u.y)-20||0}})}}}});h.render(),window.addEventListener("resize",Tn(()=>{if(!r.value)return;const{width:c,height:d}=r.value.getBoundingClientRect();h.resize(c,d)},30))};return fe(()=>{Lt(()=>{o()})}),Be(()=>{i("hide")}),(a,l)=>(k(),P("div",Fn,[M("div",{ref_key:"graph",ref:r,class:"flame-graph"},[M("canvas",{ref_key:"canvas",ref:s,class:"flame-graph__canvas"},null,512)],512)]))}}),Hn=U(zn,[["__scopeId","data-v-3ae76d8b"]]),Ln={class:"profiler-page__stat-board"},In={class:"table-wrapper"},An=["title","onClick"],Dn=G({__name:"top-functions",props:{payload:{}},setup(n){const e=n,t=S(je.EXCLUSIVE_WALL_TIME),i=Mt(async()=>await fetch(`${Re}/api/profiler/${e.payload.profile_uuid}/top?metric=${t.value}`).then(o=>o.json()),[]),s=o=>{t.value=o},r=(o,a)=>a==="ms"?Gt(o):a==="percent"?o+"%":a==="number"?new Intl.NumberFormat("en-US",{style:"decimal"}).format(o):a==="bytes"?Ut(o,3):o;return(o,a)=>(k(),P(N,null,[M("section",Ln,[C(i).overall_totals?(k(),q(C(Ze),{key:0,cost:C(i).overall_totals},null,8,["cost"])):$("",!0)]),M("div",In,[M("table",null,[M("thead",null,[M("tr",null,[(k(!0),P(N,null,ee(C(i).schema,l=>(k(),P("th",{class:j(["text-left",{selected:t.value===l.key,[`col-${l.key}`]:!0}]),title:l.description,onClick:h=>l.sortable?s(l.key):null},J(l.label),11,An))),256))])]),M("tbody",null,[(k(!0),P(N,null,ee(C(i).functions,l=>(k(),P("tr",null,[(k(!0),P(N,null,ee(C(i).schema,h=>(k(),P("td",{class:j(["text-left",{selected:t.value===h.key,[`col-${h.key}`]:!0}])},[(k(!0),P(N,null,ee(h.values,c=>(k(),P("div",{class:j(["table-value",{[`value-${c.format}`]:!0}])},J(r(l[c.key],c.format)),3))),256))],2))),256))]))),256))])])])],64))}}),$n=U(Dn,[["__scopeId","data-v-98201e25"]]),On={class:"profiler-page"},Wn={class:"profiler-page__main"},Xn={ref:"info",class:"profiler-page__stat"},Gn={class:"profiler-page__stat-tabs"},Un=G({__name:"profiler-page",props:{event:{}},setup(n){const e={x:0,y:0},t=S(),i=S(""),s=S(e),r=Q(()=>{let c=s.value.y,d=s.value.x;if(750+s.value.x>window.innerWidth-80){const u=750+s.value.x-window.innerWidth+100;d-=u}return 150+s.value.y>window.innerHeight&&(c=s.value.y-150),{top:`${c+10}px`,left:`${d}px`,width:"750px"}}),o=l=>{if(l){const{position:h,...c}=l||{};t.value=c,s.value=h}else t.value=null,s.value=e},a=l=>{i.value=l.tab.name};return(l,h)=>(k(),P("div",On,[M("main",Wn,[M("div",Xn,[M("section",Gn,[O(C(Xt),{options:{useUrlFragment:!1},onChanged:a},{default:te(()=>[O(C(me),{name:"Call graph"},{default:te(()=>[i.value==="Call graph"?(k(),q(C(hi),{key:0,payload:l.event.payload},null,8,["payload"])):$("",!0)]),_:1}),O(C(me),{name:"Flamechart"},{default:te(()=>[i.value==="Flamechart"?(k(),q(C(Hn),{key:i.value,"data-key":i.value,payload:l.event.payload,onHover:o,onHide:o},null,8,["data-key","payload"])):$("",!0)]),_:1}),O(C(me),{name:"Top functions"},{default:te(()=>[i.value==="Top functions"?(k(),q(C($n),{key:0,payload:l.event.payload},null,8,["payload"])):$("",!0)]),_:1})]),_:1})])],512),t.value?(k(),q(C(Qe),{key:0,class:"profiler-page__hover-edge",edge:t.value,style:Ee(r.value)},null,8,["edge","style"])):$("",!0)])]))}}),Vn=U(Un,[["__scopeId","data-v-0bc6ad13"]]),Te=n=>($t("data-v-e04dbead"),n=n(),Ot(),n),Nn={class:"profiler-event"},Kn={key:0,class:"profiler-event__loading"},qn=Te(()=>M("div",null,null,-1)),Bn=Te(()=>M("div",null,null,-1)),Yn=Te(()=>M("div",null,null,-1)),Zn=[qn,Bn,Yn],jn={class:"profiler-event__body"},Qn=G({__name:"[id]",setup(n){const{normalizeProfilerEvent:e}=Wt(),{params:t}=It(),{$authToken:i}=Dt(),s=At(),r=t.id;Rt(`Profiler > ${r} | Buggregator`);const{events:o}=St(),a=S(!1),l=S(null),h=Q(()=>l.value?e(l.value):null);return fe(async()=>{a.value=!0,await Tt(o.getUrl(r),{headers:{"X-Auth-Token":i.token||""},onResponse({response:{_data:d}}){l.value=d,a.value=!1},onResponseError(){s.push("/404")},onRequestError(){s.push("/404")}},"$tWhgOcWFS1")}),(d,u)=>(k(),P("main",Nn,[O(C(_t),{title:"Profiler","event-id":C(r)},null,8,["event-id"]),a.value&&!h.value?(k(),P("div",Kn,Zn)):$("",!0),M("div",jn,[h.value?(k(),q(C(Vn),{key:0,event:h.value,class:"p-5"},null,8,["event"])):$("",!0)])]))}}),ls=U(Qn,[["__scopeId","data-v-e04dbead"]]);export{ls as default};
